
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>dispel.providers.generic.tasks.draw.steps &#8212; dispel 0.1.dev1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../../../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../../../../../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../../../../../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../../../../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../../../_static/pygments.css?v=a746c00c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../../../../../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../../../../../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script src="../../../../../../_static/documentation_options.js?v=6aee1ebc"></script>
    <script src="../../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/dispel/providers/generic/tasks/draw/steps';</script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../../../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../../../_static/dispel-logo.png" class="logo__image only-light" alt="dispel 0.1.dev1 documentation - Home"/>
    <script>document.write(`<img src="../../../../../../_static/dispel-logo.png" class="logo__image only-dark" alt="dispel 0.1.dev1 documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../../installation.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../../usage.html">
                        Usage
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../../measures.html">
                        Measures
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../../api/modules.html">
                        dispel
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../../contributing.html">
                        Contributing
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../../installation.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../../usage.html">
                        Usage
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../../measures.html">
                        Measures
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../../api/modules.html">
                        dispel
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../../../contributing.html">
                        Contributing
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../../../../index.html" class="nav-link">Module code</a></li>
    
    
    <li class="breadcrumb-item"><a href="../../../../providers.html" class="nav-link">dispel.providers</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">dispel.provi...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for dispel.providers.generic.tasks.draw.steps</h1><div class="highlight"><pre>
<span></span><span class="c1"># pylint: disable=duplicate-code</span>
<span class="sd">&quot;&quot;&quot;Drawing test related functionality.</span>

<span class="sd">This module contains functionality to extract measures for the *Drawing* test</span>
<span class="sd">(DRAW).</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">Iterable</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">,</span>
    <span class="n">Set</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">cast</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">cdist</span>

<span class="kn">from</span> <span class="nn">dispel.data.core</span> <span class="kn">import</span> <span class="n">Reading</span>
<span class="kn">from</span> <span class="nn">dispel.data.flags</span> <span class="kn">import</span> <span class="n">FlagSeverity</span><span class="p">,</span> <span class="n">FlagType</span>
<span class="kn">from</span> <span class="nn">dispel.data.levels</span> <span class="kn">import</span> <span class="n">Level</span>
<span class="kn">from</span> <span class="nn">dispel.data.measures</span> <span class="kn">import</span> <span class="n">MeasureValue</span><span class="p">,</span> <span class="n">MeasureValueDefinitionPrototype</span>
<span class="kn">from</span> <span class="nn">dispel.data.raw</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DEFAULT_COLUMNS</span><span class="p">,</span>
    <span class="n">PRESSURE_VALIDATOR</span><span class="p">,</span>
    <span class="n">USER_ACC_MAP</span><span class="p">,</span>
    <span class="n">RawDataSet</span><span class="p">,</span>
    <span class="n">RawDataSetDefinition</span><span class="p">,</span>
    <span class="n">RawDataSetSource</span><span class="p">,</span>
    <span class="n">RawDataValueDefinition</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">dispel.data.validators</span> <span class="kn">import</span> <span class="n">GREATER_THAN_ZERO</span><span class="p">,</span> <span class="n">RangeValidator</span>
<span class="kn">from</span> <span class="nn">dispel.data.values</span> <span class="kn">import</span> <span class="n">AbbreviatedValue</span> <span class="k">as</span> <span class="n">AV</span>
<span class="kn">from</span> <span class="nn">dispel.data.values</span> <span class="kn">import</span> <span class="n">ValueDefinition</span>
<span class="kn">from</span> <span class="nn">dispel.io.raw</span> <span class="kn">import</span> <span class="n">generate_raw_data_value_definition</span>
<span class="kn">from</span> <span class="nn">dispel.processing.core</span> <span class="kn">import</span> <span class="n">ErrorHandling</span><span class="p">,</span> <span class="n">ProcessingStep</span><span class="p">,</span> <span class="n">ProcessResultType</span>
<span class="kn">from</span> <span class="nn">dispel.processing.data_set</span> <span class="kn">import</span> <span class="n">RawDataSetProcessingResult</span><span class="p">,</span> <span class="n">transformation</span>
<span class="kn">from</span> <span class="nn">dispel.processing.extract</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BASIC_AGGREGATIONS</span><span class="p">,</span>
    <span class="n">DEFAULT_AGGREGATIONS</span><span class="p">,</span>
    <span class="n">DEFAULT_AGGREGATIONS_Q95_CV</span><span class="p">,</span>
    <span class="n">AggregateMeasures</span><span class="p">,</span>
    <span class="n">AggregateModalities</span><span class="p">,</span>
    <span class="n">AggregateRawDataSetColumn</span><span class="p">,</span>
    <span class="n">ExtractMultipleStep</span><span class="p">,</span>
    <span class="n">ExtractStep</span><span class="p">,</span>
    <span class="n">MeasureDefinitionMixin</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">dispel.processing.flags</span> <span class="kn">import</span> <span class="n">flag</span>
<span class="kn">from</span> <span class="nn">dispel.processing.level</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FlagLevelStep</span><span class="p">,</span>
    <span class="n">LevelFilter</span><span class="p">,</span>
    <span class="n">LevelIdFilter</span><span class="p">,</span>
    <span class="n">LevelProcessingResult</span><span class="p">,</span>
    <span class="n">LevelProcessingStep</span><span class="p">,</span>
    <span class="n">LevelProcessingStepProtocol</span><span class="p">,</span>
    <span class="n">ProcessingStepGroup</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">dispel.processing.level_filters</span> <span class="kn">import</span> <span class="n">NotEmptyDatasetFilter</span>
<span class="kn">from</span> <span class="nn">dispel.processing.modalities</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">HandModality</span><span class="p">,</span>
    <span class="n">HandModalityFilter</span><span class="p">,</span>
    <span class="n">SensorModality</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">dispel.processing.transform</span> <span class="kn">import</span> <span class="n">ConcatenateLevels</span><span class="p">,</span> <span class="n">TransformStep</span>
<span class="kn">from</span> <span class="nn">dispel.providers.generic.activity.orientation</span> <span class="kn">import</span> <span class="n">UpperLimbOrientationFlagger</span>
<span class="kn">from</span> <span class="nn">dispel.providers.generic.flags.ue_flags</span> <span class="kn">import</span> <span class="n">OnlyOneHandPerformed</span>
<span class="kn">from</span> <span class="nn">dispel.providers.generic.sensor</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FREQ_20HZ</span><span class="p">,</span>
    <span class="n">FREQ_60HZ</span><span class="p">,</span>
    <span class="n">RenameColumns</span><span class="p">,</span>
    <span class="n">Resample</span><span class="p">,</span>
    <span class="n">SetTimestampIndex</span><span class="p">,</span>
    <span class="n">TransformUserAcceleration</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">dispel.providers.generic.tasks.draw.modalities</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AttemptModality</span><span class="p">,</span>
    <span class="n">AttemptModalityFilter</span><span class="p">,</span>
    <span class="n">ShapeModality</span><span class="p">,</span>
    <span class="n">ShapeModalityFilter</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">dispel.providers.generic.tasks.draw.shapes</span> <span class="kn">import</span> <span class="n">get_user_path</span><span class="p">,</span> <span class="n">get_valid_path</span>
<span class="kn">from</span> <span class="nn">dispel.providers.generic.tasks.draw.touch</span> <span class="kn">import</span> <span class="n">DrawShape</span><span class="p">,</span> <span class="n">DrawTouch</span>
<span class="kn">from</span> <span class="nn">dispel.providers.generic.tremor</span> <span class="kn">import</span> <span class="n">TremorMeasures</span>
<span class="kn">from</span> <span class="nn">dispel.signal.core</span> <span class="kn">import</span> <span class="n">euclidean_norm</span><span class="p">,</span> <span class="n">sparc</span>
<span class="kn">from</span> <span class="nn">dispel.stats.core</span> <span class="kn">import</span> <span class="n">variation</span>

<span class="n">TASK_NAME</span> <span class="o">=</span> <span class="n">AV</span><span class="p">(</span><span class="s2">&quot;Drawing test&quot;</span><span class="p">,</span> <span class="s2">&quot;DRAW&quot;</span><span class="p">)</span>

<span class="c1"># The definition of the DrawShape raw data set.</span>
<span class="n">_SHAPE_DEFINITION</span> <span class="o">=</span> <span class="p">[</span><span class="n">generate_raw_data_value_definition</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">)]</span>

<span class="c1">#: The new names for reference and user trajectories (x and y coordinates).</span>
<span class="n">_TRAJECTORY</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>

<span class="n">_UNITS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">]</span>

<span class="n">_TRAJECTORY_DEFINITIONS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
    <span class="nb">map</span><span class="p">(</span><span class="n">generate_raw_data_value_definition</span><span class="p">,</span> <span class="n">_TRAJECTORY</span><span class="p">,</span> <span class="n">_UNITS</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">RADIUS</span> <span class="o">=</span> <span class="mi">8</span>
<span class="sa">r</span><span class="sd">&quot;&quot;&quot;The radius of the circle used to consider if a point from the reference</span>
<span class="sd">path has been covered by the user trajectory. The value of 8 corresponds to</span>
<span class="sd">the size of a fingertip.&quot;&quot;&quot;</span>

<span class="n">SHAPE_TO_ABBR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;square_clock&quot;</span><span class="p">:</span> <span class="s2">&quot;sc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;square_counter_clock&quot;</span><span class="p">:</span> <span class="s2">&quot;scc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;infinity&quot;</span><span class="p">:</span> <span class="s2">&quot;inf&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spiral&quot;</span><span class="p">:</span> <span class="s2">&quot;spi&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">DRAWING_SIM_MEDIAN_Q95_MINUS_Q05</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;inf&quot;</span><span class="p">:</span> <span class="mf">8.096</span><span class="p">,</span>
    <span class="s2">&quot;sc&quot;</span><span class="p">:</span> <span class="mf">8.641</span><span class="p">,</span>
    <span class="s2">&quot;scc&quot;</span><span class="p">:</span> <span class="mf">8.952</span><span class="p">,</span>
    <span class="s2">&quot;spi&quot;</span><span class="p">:</span> <span class="mf">6.674</span><span class="p">,</span>
<span class="p">}</span>
<span class="sa">r</span><span class="sd">&quot;&quot;&quot;The distance between quantile 95 and quantile 5 of similarity median on</span>
<span class="sd">healthy population for the different shape.&quot;&quot;&quot;</span>

<span class="n">DRAWING_SIM_MEDIAN_MEAN</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;inf&quot;</span><span class="p">:</span> <span class="mf">6.353</span><span class="p">,</span> <span class="s2">&quot;sc&quot;</span><span class="p">:</span> <span class="mf">5.753</span><span class="p">,</span> <span class="s2">&quot;scc&quot;</span><span class="p">:</span> <span class="mf">5.989</span><span class="p">,</span> <span class="s2">&quot;spi&quot;</span><span class="p">:</span> <span class="mf">5.821</span><span class="p">}</span>
<span class="sa">r</span><span class="sd">&quot;&quot;&quot;Mean of similarity median on healthy population for the different shape.&quot;&quot;&quot;</span>

<span class="n">DRAWING_USER_DURATION_Q95_MINUS_Q05</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;inf&quot;</span><span class="p">:</span> <span class="mi">6012</span><span class="p">,</span>
    <span class="s2">&quot;sc&quot;</span><span class="p">:</span> <span class="mi">5699</span><span class="p">,</span>
    <span class="s2">&quot;scc&quot;</span><span class="p">:</span> <span class="mi">5738</span><span class="p">,</span>
    <span class="s2">&quot;spi&quot;</span><span class="p">:</span> <span class="mi">8671</span><span class="p">,</span>
<span class="p">}</span>
<span class="sa">r</span><span class="sd">&quot;&quot;&quot;The distance between quantile 95 and quantile 5 of user duration on</span>
<span class="sd">healthy population for the different shape.&quot;&quot;&quot;</span>

<span class="n">DRAWING_USER_DURATION_MEAN</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;inf&quot;</span><span class="p">:</span> <span class="mi">4004</span><span class="p">,</span>
    <span class="s2">&quot;sc&quot;</span><span class="p">:</span> <span class="mi">3877</span><span class="p">,</span>
    <span class="s2">&quot;scc&quot;</span><span class="p">:</span> <span class="mi">3985</span><span class="p">,</span>
    <span class="s2">&quot;spi&quot;</span><span class="p">:</span> <span class="mi">5571</span><span class="p">,</span>
<span class="p">}</span>
<span class="sa">r</span><span class="sd">&quot;&quot;&quot;Mean of user duration on healthy population for the different shape.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="get_user_duration">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.get_user_duration">[docs]</a>
<span class="k">def</span> <span class="nf">get_user_duration</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the duration of the total interaction of the user with the test.</span>

<span class="sd">    Also compute the reaction time of the user between the beginning of the</span>
<span class="sd">    test and his first interaction.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data</span>
<span class="sd">        A pandas data frame composed of at least the user path and associated</span>
<span class="sd">        timestamps as index.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The total duration (in milliseconds) of the user drawing action.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timestamps</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">timestamps</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">timestamps</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1e3</span></div>



<div class="viewcode-block" id="get_instant_speed">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.get_instant_speed">[docs]</a>
<span class="k">def</span> <span class="nf">get_instant_speed</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the instantaneous speed of the drawing.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data</span>
<span class="sd">        A pandas data frame composed of at least the user path and associated</span>
<span class="sd">        timestamps as index.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.float64</span>
<span class="sd">        The instantaneous speed of the drawing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get rid of duplicated timestamps</span>
    <span class="n">shape_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">shape_data</span><span class="p">,</span> <span class="s2">&quot;valid_data&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;last&quot;</span><span class="p">)]</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">euclidean_norm</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">diff</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">speed</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">))</span></div>



<div class="viewcode-block" id="get_speed_accuracy">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.get_speed_accuracy">[docs]</a>
<span class="k">def</span> <span class="nf">get_speed_accuracy</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">mean_dist</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the speed accuracy of the user for a given level.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data</span>
<span class="sd">        A pandas data frame corresponding to the</span>
<span class="sd">        :class:`~dispel.providers.generic.tasks.draw.touch.DrawShape` data of the given</span>
<span class="sd">        level.</span>
<span class="sd">    mean_dist</span>
<span class="sd">        The mean dtw minimum distance for the given level.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The speed accuracy for the given level (unit: point-1.ms-1).</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    AssertionError</span>
<span class="sd">        If ``speed * accuracy`` is equal to zero and ends up with a</span>
<span class="sd">        ZeroDivisionError for the ratio: ``1 / (speed * accuracy)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">duration_params</span> <span class="o">=</span> <span class="n">get_user_duration</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># explicit time depending on accuracy</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">speed_accuracy</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">duration_params</span> <span class="o">*</span> <span class="n">mean_dist</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
            <span class="s2">&quot;``speed * accuracy`` cannot be equal to zero.&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">exception</span>
    <span class="k">return</span> <span class="n">speed_accuracy</span></div>



<div class="viewcode-block" id="reaction_time">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.reaction_time">[docs]</a>
<span class="k">def</span> <span class="nf">reaction_time</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Level</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the reaction time.</span>

<span class="sd">    The reaction time of the user between the shape appearance and the first</span>
<span class="sd">    touch event.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data</span>
<span class="sd">        pandas data frame containing at least &#39;tsTouch&#39; pd Series.</span>
<span class="sd">    level</span>
<span class="sd">        The level to be processed.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        the user&#39;s reaction time for the given level (in milliseconds).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_touch</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tsTouch</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">level_start</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">start</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">first_touch</span> <span class="o">-</span> <span class="n">level_start</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1e3</span></div>



<div class="viewcode-block" id="wrap_reaction_time">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.wrap_reaction_time">[docs]</a>
<span class="k">def</span> <span class="nf">wrap_reaction_time</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Level</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrap reaction time in a Series for a better aggregation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data</span>
<span class="sd">        pandas data frame containing at least &#39;tsTouch&#39; pd Series.</span>
<span class="sd">    level</span>
<span class="sd">        The level to be processed.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        A pandas Series of the user&#39;s reaction time for the given level</span>
<span class="sd">        (in milliseconds).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;reaction_time&quot;</span><span class="p">:</span> <span class="n">reaction_time</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">level</span><span class="p">)})</span></div>



<div class="viewcode-block" id="CreateShapes">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.CreateShapes">[docs]</a>
<span class="k">class</span> <span class="nc">CreateShapes</span><span class="p">(</span><span class="n">LevelProcessingStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A LevelProcessingStep to create a ``DrawShape`` per level.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="CreateShapes.process_level">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.CreateShapes.process_level">[docs]</a>
    <span class="k">def</span> <span class="nf">process_level</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Level</span><span class="p">,</span> <span class="n">reading</span><span class="p">:</span> <span class="n">Reading</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProcessResultType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the provided Level.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        level</span>
<span class="sd">            The level to be processed</span>
<span class="sd">        reading</span>
<span class="sd">            The reading to be processed</span>
<span class="sd">        kwargs</span>
<span class="sd">            Additional arguments passed by :meth:`process_level`.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        ProcessResultType</span>
<span class="sd">            Passes through anything that is yielded from the</span>
<span class="sd">            :meth:`process_level` function.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_create_draw_shapes</span><span class="p">(</span>
            <span class="n">level</span><span class="p">:</span> <span class="n">Level</span><span class="p">,</span> <span class="n">reading</span><span class="p">:</span> <span class="n">Reading</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">shape_data</span> <span class="o">=</span> <span class="n">DrawShape</span><span class="o">.</span><span class="n">from_level</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">reading</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">assertion_error</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;When creating shape for level </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">level</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="si">}</span><span class="s2"> the&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;post init raised an error: </span><span class="si">{</span><span class="n">assertion_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="ne">Warning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">]),</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">shape_data</span><span class="p">]}),</span> <span class="kc">True</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">_create_draw_shapes</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">reading</span><span class="p">)</span>

        <span class="c1"># second condition</span>
        <span class="n">level</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="n">error</span><span class="p">,</span>
            <span class="n">ValueDefinition</span><span class="p">(</span>
                <span class="s2">&quot;is_creatable_shape&quot;</span><span class="p">,</span>
                <span class="s2">&quot;If a shape does not raise an error when creating from level.&quot;</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;True if the shape is creatable False otherwise.&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">raw_data_set</span> <span class="o">=</span> <span class="n">RawDataSet</span><span class="p">(</span>
            <span class="n">definition</span><span class="o">=</span><span class="n">RawDataSetDefinition</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;shape&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">RawDataSetSource</span><span class="p">(</span><span class="s2">&quot;ads&quot;</span><span class="p">),</span>
                <span class="n">value_definitions_list</span><span class="o">=</span><span class="n">_SHAPE_DEFINITION</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">yield</span> <span class="n">RawDataSetProcessingResult</span><span class="p">(</span>
            <span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">sources</span><span class="o">=</span><span class="n">level</span><span class="o">.</span><span class="n">get_raw_data_set</span><span class="p">(</span><span class="s2">&quot;screen&quot;</span><span class="p">),</span>
            <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span>
            <span class="n">result</span><span class="o">=</span><span class="n">raw_data_set</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ValidPathAssertionMixin">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ValidPathAssertionMixin">[docs]</a>
<span class="k">class</span> <span class="nc">ValidPathAssertionMixin</span><span class="p">(</span><span class="n">LevelProcessingStepProtocol</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assertion mixin to ensure a valid path is present.&quot;&quot;&quot;</span>

    <span class="c1">#: The error handling should no valid path be obtained</span>
    <span class="n">missing_path_error_handling</span> <span class="o">=</span> <span class="n">ErrorHandling</span><span class="o">.</span><span class="n">IGNORE</span>

<div class="viewcode-block" id="ValidPathAssertionMixin.assert_valid_level">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ValidPathAssertionMixin.assert_valid_level">[docs]</a>
    <span class="k">def</span> <span class="nf">assert_valid_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Level</span><span class="p">,</span> <span class="n">reading</span><span class="p">:</span> <span class="n">Reading</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assert that there are valid paths.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_raw_value</span><span class="p">(</span><span class="s2">&quot;is_valid_path&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Invalid user path&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_path_error_handling</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="CreatableShape">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.CreatableShape">[docs]</a>
<span class="k">class</span> <span class="nc">CreatableShape</span><span class="p">(</span><span class="n">LevelFilter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A level filter to fetch level with creatable shapes only.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="CreatableShape.repr">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.CreatableShape.repr">[docs]</a>
    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get representation of the filter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Creatable shapes&quot;</span></div>


<div class="viewcode-block" id="CreatableShape.filter">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.CreatableShape.filter">[docs]</a>
    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">levels</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Level</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">Level</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Keep level with a creatable shape from level.&quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="s2">&quot;is_creatable_shape&quot;</span> <span class="ow">in</span> <span class="n">level</span><span class="o">.</span><span class="n">context</span>
                <span class="ow">and</span> <span class="n">level</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_raw_value</span><span class="p">(</span><span class="s2">&quot;is_creatable_shape&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
            <span class="p">):</span>
                <span class="n">out</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>
</div>



<span class="k">def</span> <span class="nf">_flag_level_is_continuous</span><span class="p">(</span><span class="n">level</span><span class="p">:</span> <span class="n">Level</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return False if the level include a non-continuous shape.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="o">.</span><span class="n">has_raw_data_set</span><span class="p">(</span><span class="s2">&quot;screen&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">screen</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">get_raw_data_set</span><span class="p">(</span><span class="s2">&quot;screen&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
    <span class="c1"># Flag there is not several touchPathId</span>
    <span class="k">if</span> <span class="s2">&quot;inEndZone&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">screen</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">screen</span><span class="p">[</span><span class="s2">&quot;touchPathId&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="c1"># Flag there is not several down touchAction</span>
    <span class="n">condition_down</span> <span class="o">=</span> <span class="p">(</span><span class="n">screen</span><span class="p">[</span><span class="s2">&quot;touchAction&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="c1"># Flag there is not several up touchAction</span>
    <span class="n">condition_up</span> <span class="o">=</span> <span class="p">(</span><span class="n">screen</span><span class="p">[</span><span class="s2">&quot;touchAction&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">condition_down</span> <span class="o">&amp;</span> <span class="n">condition_up</span>


<div class="viewcode-block" id="ContinuousLevel">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ContinuousLevel">[docs]</a>
<span class="k">class</span> <span class="nc">ContinuousLevel</span><span class="p">(</span><span class="n">LevelFilter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter for continuous drawing shape.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ContinuousLevel.repr">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ContinuousLevel.repr">[docs]</a>
    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get representation of the filter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;only continuously drawn shapes&quot;</span></div>


<div class="viewcode-block" id="ContinuousLevel.filter">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ContinuousLevel.filter">[docs]</a>
    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">levels</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Level</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Level</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter levels with continuous drawn shapes.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">_flag_level_is_continuous</span><span class="p">,</span> <span class="n">levels</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="TransformValidUserPath">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.TransformValidUserPath">[docs]</a>
<span class="k">class</span> <span class="nc">TransformValidUserPath</span><span class="p">(</span><span class="n">FlagLevelStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Transform step to determine if the user path is valid.&quot;&quot;&quot;</span>

    <span class="n">level_filter</span> <span class="o">=</span> <span class="n">CreatableShape</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">ContinuousLevel</span><span class="p">()</span>

<div class="viewcode-block" id="TransformValidUserPath.is_valid_level">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.TransformValidUserPath.is_valid_level">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_valid_level</span><span class="p">(</span><span class="n">level</span><span class="p">:</span> <span class="n">Level</span><span class="p">,</span> <span class="n">reading</span><span class="p">:</span> <span class="n">Reading</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assert that there are valid paths.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">get_raw_data_set</span><span class="p">(</span><span class="s2">&quot;screen&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="o">.</span><span class="n">has_raw_data_set</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">get_raw_data_set</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">get_reference</span>
        <span class="k">if</span> <span class="n">reading</span><span class="o">.</span><span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">reading</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">screen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">reading</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">height_dp_pt</span>
        <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">get_user_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">valid_paths</span> <span class="o">=</span> <span class="n">get_valid_path</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
        <span class="c1"># first condition to be valid</span>
        <span class="n">condition_1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">valid_paths</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;touchAction&quot;</span><span class="p">,</span> <span class="s2">&quot;isValidArea&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">condition_1</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">up_sampled_data_without_overshoot</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="c1"># second condition</span>
        <span class="n">level</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="n">result</span><span class="p">,</span>
            <span class="n">ValueDefinition</span><span class="p">(</span>
                <span class="s2">&quot;is_valid_shape&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Contains a valid shape&quot;</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;True if the shape is not empty after &quot;</span>
                <span class="s2">&quot;applying pre-processing removing overshoots.&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>


    <span class="n">task_name</span> <span class="o">=</span> <span class="n">TASK_NAME</span>
    <span class="n">flag_name</span> <span class="o">=</span> <span class="n">AV</span><span class="p">(</span><span class="s2">&quot;valid user path&quot;</span><span class="p">,</span> <span class="s2">&quot;val_user_path&quot;</span><span class="p">)</span>
    <span class="n">flag_type</span> <span class="o">=</span> <span class="n">FlagType</span><span class="o">.</span><span class="n">TECHNICAL</span>
    <span class="n">flag_severity</span> <span class="o">=</span> <span class="n">FlagSeverity</span><span class="o">.</span><span class="n">DEVIATION</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;The user path after pre-processing is empty. &quot;</span>
    <span class="n">flagging_function</span> <span class="o">=</span> <span class="n">is_valid_level</span></div>



<div class="viewcode-block" id="ValidUserPath">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ValidUserPath">[docs]</a>
<span class="k">class</span> <span class="nc">ValidUserPath</span><span class="p">(</span><span class="n">LevelFilter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A level filter to fetch level with valid user path only.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ValidUserPath.repr">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ValidUserPath.repr">[docs]</a>
    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get representation of the filter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;valid user path&quot;</span></div>


<div class="viewcode-block" id="ValidUserPath.filter">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ValidUserPath.filter">[docs]</a>
    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">levels</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Level</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">Level</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Keep level with a valid user path.&quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;is_valid_shape&quot;</span> <span class="ow">in</span> <span class="n">level</span><span class="o">.</span><span class="n">context</span> <span class="ow">and</span> <span class="n">level</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_raw_value</span><span class="p">(</span>
                <span class="s2">&quot;is_valid_shape&quot;</span>
            <span class="p">):</span>
                <span class="n">out</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>
</div>



<div class="viewcode-block" id="FlagContinuousDrawing">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.FlagContinuousDrawing">[docs]</a>
<span class="k">class</span> <span class="nc">FlagContinuousDrawing</span><span class="p">(</span><span class="n">FlagLevelStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flag the user do not lift the finger while drawing.&quot;&quot;&quot;</span>

    <span class="n">task_name</span> <span class="o">=</span> <span class="n">TASK_NAME</span>
    <span class="n">flag_name</span> <span class="o">=</span> <span class="n">AV</span><span class="p">(</span><span class="s2">&quot;continous drawing&quot;</span><span class="p">,</span> <span class="s2">&quot;continuous_drawing&quot;</span><span class="p">)</span>
    <span class="n">flag_type</span> <span class="o">=</span> <span class="n">FlagType</span><span class="o">.</span><span class="n">BEHAVIORAL</span>
    <span class="n">flag_severity</span> <span class="o">=</span> <span class="n">FlagSeverity</span><span class="o">.</span><span class="n">DEVIATION</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;The drawing is not continuous, the user has lifted the finger&quot;</span>
        <span class="s2">&quot;during level </span><span class="si">{level_id}</span><span class="s2">.&quot;</span>
    <span class="p">)</span>

    <span class="nd">@flag</span>
    <span class="k">def</span> <span class="nf">_check_continuous_drawing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Level</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_flag_kwargs</span><span class="p">(</span><span class="n">level_id</span><span class="o">=</span><span class="n">level</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_flag_level_is_continuous</span><span class="p">(</span><span class="n">level</span><span class="p">)</span></div>



<div class="viewcode-block" id="InfinityShapes">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.InfinityShapes">[docs]</a>
<span class="k">class</span> <span class="nc">InfinityShapes</span><span class="p">(</span><span class="n">LevelFilter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A level filter to fetch level from infinity shapes.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="InfinityShapes.repr">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.InfinityShapes.repr">[docs]</a>
    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get representation of the filter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;infinity shapes&quot;</span></div>


<div class="viewcode-block" id="InfinityShapes.filter">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.InfinityShapes.filter">[docs]</a>
    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">levels</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Level</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">Level</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get infinity shapes.&quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;inf&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">level</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
                <span class="n">out</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>
</div>



<div class="viewcode-block" id="CreatableShapeFlag">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.CreatableShapeFlag">[docs]</a>
<span class="k">class</span> <span class="nc">CreatableShapeFlag</span><span class="p">(</span><span class="n">FlagLevelStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Transform step to determine if the shape is creatable in a level.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="CreatableShapeFlag.shape_is_creatable">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.CreatableShapeFlag.shape_is_creatable">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">shape_is_creatable</span><span class="p">(</span><span class="n">level</span><span class="p">:</span> <span class="n">Level</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assert that the shape can be created from the level.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;is_creatable_shape&quot;</span> <span class="ow">in</span> <span class="n">level</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">level</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_raw_value</span><span class="p">(</span><span class="s2">&quot;is_creatable_shape&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


    <span class="n">task_name</span> <span class="o">=</span> <span class="n">TASK_NAME</span>
    <span class="n">flag_name</span> <span class="o">=</span> <span class="n">AV</span><span class="p">(</span><span class="s2">&quot;draw creatable shape&quot;</span><span class="p">,</span> <span class="s2">&quot;draw_creatable_shape&quot;</span><span class="p">)</span>
    <span class="n">flag_type</span> <span class="o">=</span> <span class="n">FlagType</span><span class="o">.</span><span class="n">TECHNICAL</span>
    <span class="n">flag_severity</span> <span class="o">=</span> <span class="n">FlagSeverity</span><span class="o">.</span><span class="n">DEVIATION</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;The shape was impossible to create from the level. &quot;</span>
    <span class="n">flagging_function</span> <span class="o">=</span> <span class="n">shape_is_creatable</span></div>



<div class="viewcode-block" id="TransformDecelerationProfile">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.TransformDecelerationProfile">[docs]</a>
<span class="k">class</span> <span class="nc">TransformDecelerationProfile</span><span class="p">(</span><span class="n">TransformStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A raw data transformation step to get the user deceleration profile.&quot;&quot;&quot;</span>

    <span class="n">data_set_ids</span> <span class="o">=</span> <span class="s2">&quot;shape&quot;</span>
    <span class="n">new_data_set_id</span> <span class="o">=</span> <span class="s2">&quot;deceleration&quot;</span>
    <span class="n">definitions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RawDataValueDefinition</span><span class="p">(</span>
            <span class="s2">&quot;tsTouch&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp of interactions data&quot;</span><span class="p">,</span> <span class="s2">&quot;datetime64&quot;</span>
        <span class="p">),</span>
        <span class="n">RawDataValueDefinition</span><span class="p">(</span><span class="s2">&quot;min_distance&quot;</span><span class="p">,</span> <span class="s2">&quot;DTW distance data&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">),</span>
        <span class="n">RawDataValueDefinition</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x user trajectory&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">),</span>
        <span class="n">RawDataValueDefinition</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;y user trajectory&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">),</span>
    <span class="p">]</span>

<div class="viewcode-block" id="TransformDecelerationProfile.retrieve_deceleration_from_shape">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.TransformDecelerationProfile.retrieve_deceleration_from_shape">[docs]</a>
    <span class="nd">@transformation</span>
    <span class="k">def</span> <span class="nf">retrieve_deceleration_from_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the deceleration data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">deceleration_data</span></div>


<div class="viewcode-block" id="TransformDecelerationProfile.assert_valid_level">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.TransformDecelerationProfile.assert_valid_level">[docs]</a>
    <span class="k">def</span> <span class="nf">assert_valid_level</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Level</span><span class="p">,</span> <span class="n">reading</span><span class="p">:</span> <span class="n">Reading</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>  <span class="c1"># type: ignore</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flag the presence of a valid user path.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">assert_valid_level</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">reading</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">draw</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">get_raw_data_set</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">aggregate_valid_touches</span><span class="o">.</span><span class="n">positions</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No user path found for level </span><span class="si">{</span><span class="n">level</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ErrorHandling</span><span class="o">.</span><span class="n">RAISE</span>
            <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TransformReactionTime">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.TransformReactionTime">[docs]</a>
<span class="k">class</span> <span class="nc">TransformReactionTime</span><span class="p">(</span><span class="n">TransformStep</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A raw data set transformation step to get user&#39;s reaction time.&quot;&quot;&quot;</span>

    <span class="n">data_set_ids</span> <span class="o">=</span> <span class="s2">&quot;screen&quot;</span>
    <span class="n">new_data_set_id</span> <span class="o">=</span> <span class="s2">&quot;reaction-time&quot;</span>
    <span class="n">transform_function</span> <span class="o">=</span> <span class="n">wrap_reaction_time</span>
    <span class="n">definitions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RawDataValueDefinition</span><span class="p">(</span><span class="s2">&quot;reaction_time&quot;</span><span class="p">,</span> <span class="s2">&quot;Reaction time data&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">)</span>
    <span class="p">]</span></div>



<div class="viewcode-block" id="TransformInstantSpeed">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.TransformInstantSpeed">[docs]</a>
<span class="k">class</span> <span class="nc">TransformInstantSpeed</span><span class="p">(</span><span class="n">TransformStep</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A raw data set transformation step to get user&#39;s instantaneous speed.&quot;&quot;&quot;</span>

    <span class="n">data_set_ids</span> <span class="o">=</span> <span class="s2">&quot;shape&quot;</span>
    <span class="n">new_data_set_id</span> <span class="o">=</span> <span class="s2">&quot;instantaneous_speed&quot;</span>
    <span class="n">transform_function</span> <span class="o">=</span> <span class="n">get_instant_speed</span>
    <span class="n">definitions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RawDataValueDefinition</span><span class="p">(</span><span class="s2">&quot;speed&quot;</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">),</span>
        <span class="n">RawDataValueDefinition</span><span class="p">(</span><span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">),</span>
    <span class="p">]</span></div>



<div class="viewcode-block" id="AggregateInstantSpeed">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateInstantSpeed">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateInstantSpeed</span><span class="p">(</span><span class="n">AggregateRawDataSetColumn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract instant speed measures.&quot;&quot;&quot;</span>

    <span class="n">data_set_ids</span> <span class="o">=</span> <span class="s2">&quot;instantaneous_speed&quot;</span>

<div class="viewcode-block" id="AggregateInstantSpeed.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateInstantSpeed.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
            <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;instant speed&quot;</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="p">),</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;point.s-1&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The </span><span class="si">{aggregation}</span><span class="s2"> of the instantaneous speed while &quot;</span>
            <span class="s2">&quot;drawing.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">data_set_id</span><span class="o">=</span><span class="s2">&quot;instantaneous_speed&quot;</span><span class="p">,</span>
            <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;speed&quot;</span><span class="p">,</span>
            <span class="n">aggregations</span><span class="o">=</span><span class="n">DEFAULT_AGGREGATIONS_Q95_CV</span><span class="p">,</span>
            <span class="n">definition</span><span class="o">=</span><span class="n">definition</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ExtractShapeMixIn">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractShapeMixIn">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractShapeMixIn</span><span class="p">(</span><span class="n">LevelProcessingStep</span><span class="p">,</span> <span class="n">MeasureDefinitionMixin</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Transformation step that applies a function on targets.&quot;&quot;&quot;</span>

    <span class="n">data_set_ids</span> <span class="o">=</span> <span class="s2">&quot;shape&quot;</span>
    <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="n">extract</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">target_dtype</span> <span class="o">=</span> <span class="s2">&quot;float64&quot;</span>

<div class="viewcode-block" id="ExtractShapeMixIn.get_properties">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractShapeMixIn.get_properties">[docs]</a>
    <span class="k">def</span> <span class="nf">get_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">DrawShape</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get property from an attempt.&quot;&quot;&quot;</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span>
        <span class="k">assert</span> <span class="n">properties</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;No properties are given.&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span><span class="n">properties</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="nb">getattr</span><span class="p">,</span> <span class="n">shape</span><span class="p">),</span> <span class="n">properties</span><span class="p">))</span></div>


<div class="viewcode-block" id="ExtractShapeMixIn.get_extract_function">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractShapeMixIn.get_extract_function">[docs]</a>
    <span class="k">def</span> <span class="nf">get_extract_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the function to be applied to the data set.&quot;&quot;&quot;</span>
        <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s2">&quot;__func__&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="vm">__func__</span>  <span class="c1"># type: ignore</span>
        <span class="k">return</span> <span class="n">func</span></div>


    <span class="k">def</span> <span class="nf">_extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_properties</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">get_extract_function</span><span class="p">()(</span><span class="o">*</span><span class="n">properties</span><span class="p">)])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_dtype</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="ExtractShapeMixIn.process_level">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractShapeMixIn.process_level">[docs]</a>
    <span class="k">def</span> <span class="nf">process_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">reading</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Overwrite process level.&quot;&quot;&quot;</span>
        <span class="n">kwargs_extended</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">kwargs_extended</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">level</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">raw_data_set</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">get_raw_data_set</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract</span><span class="p">(</span><span class="n">raw_data_set</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">LevelProcessingResult</span><span class="p">(</span>
            <span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">sources</span><span class="o">=</span><span class="n">raw_data_set</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span>
            <span class="n">result</span><span class="o">=</span><span class="n">MeasureValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_definition</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs_extended</span><span class="p">),</span> <span class="n">res</span><span class="p">),</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ExtractDuration">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractDuration">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractDuration</span><span class="p">(</span><span class="n">ExtractShapeMixIn</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract total duration of drawing.&quot;&quot;&quot;</span>

    <span class="n">properties</span> <span class="o">=</span> <span class="s2">&quot;all_data&quot;</span>
    <span class="n">extract</span> <span class="o">=</span> <span class="n">get_user_duration</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;drawing duration&quot;</span><span class="p">,</span> <span class="s2">&quot;user_dur&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The time spend between the first and last interaction&quot;</span>
        <span class="s2">&quot;of the subject with the screen while drawing </span><span class="si">{shape}</span><span class="s2">&quot;</span>
        <span class="s2">&quot;with their </span><span class="si">{hand}</span><span class="s2"> hand for the </span><span class="si">{attempt}</span><span class="s2"> attempt.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="ExtractIntersections">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractIntersections">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractIntersections</span><span class="p">(</span><span class="n">ExtractShapeMixIn</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract total number of intersections between the user and the model.&quot;&quot;&quot;</span>

    <span class="n">properties</span> <span class="o">=</span> <span class="s2">&quot;intersection_measures&quot;</span>
    <span class="n">extract</span> <span class="o">=</span> <span class="nb">len</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;intersections&quot;</span><span class="p">,</span> <span class="s2">&quot;cross&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The number of times the user cross the shape line &quot;</span>
        <span class="s2">&quot;with his finger while drawing </span><span class="si">{shape}</span><span class="s2"> shape&quot;</span>
        <span class="s2">&quot;with their </span><span class="si">{hand}</span><span class="s2"> hand for the </span><span class="si">{attempt}</span><span class="s2"> attempt.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="ExtractIntersectionsPerSeconds">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractIntersectionsPerSeconds">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractIntersectionsPerSeconds</span><span class="p">(</span><span class="n">ExtractShapeMixIn</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract the mean number of intersections per second.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ExtractIntersectionsPerSeconds.get_cross_per_sec">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractIntersectionsPerSeconds.get_cross_per_sec">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_cross_per_sec</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of crossings per second.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;cross_per_sec&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>


    <span class="n">properties</span> <span class="o">=</span> <span class="s2">&quot;intersection_measures&quot;</span>
    <span class="n">extract</span> <span class="o">=</span> <span class="n">get_cross_per_sec</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;intersections per second&quot;</span><span class="p">,</span> <span class="s2">&quot;cross_per_sec&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The mean number of intersection per second the user&quot;</span>
        <span class="s2">&quot; performs with his finger while drawing </span><span class="si">{shape}</span><span class="s2"> shape &quot;</span>
        <span class="s2">&quot;with their </span><span class="si">{hand}</span><span class="s2"> hand for the </span><span class="si">{attempt}</span><span class="s2"> attempt.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="ExtractIntersectionsFrequency">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractIntersectionsFrequency">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractIntersectionsFrequency</span><span class="p">(</span><span class="n">ExtractMultipleStep</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract total number of intersections between the user and the model.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ExtractIntersectionsFrequency.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractIntersectionsFrequency.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">_intersection_frequency_factory</span><span class="p">(</span><span class="n">agg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">agg_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="p">(</span>
                    <span class="mi">1</span> <span class="o">/</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">intersection_measures</span><span class="p">[</span><span class="s2">&quot;tsDiff&quot;</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg</span><span class="p">),</span>
                <span class="n">aggregation</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="n">agg_label</span><span class="p">,</span> <span class="n">agg</span><span class="p">),</span>
                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">def</span> <span class="nf">_cv_intersection_frequency_factory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">variation</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">intersection_measures</span><span class="p">[</span><span class="s2">&quot;freqDiff&quot;</span><span class="p">]</span>
                <span class="p">),</span>
                <span class="n">aggregation</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;coefficient of variation&quot;</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">),</span>
                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">data_set</span> <span class="o">=</span> <span class="s2">&quot;shape&quot;</span>
        <span class="n">function</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">_intersection_frequency_factory</span><span class="p">(</span><span class="n">agg</span><span class="p">,</span> <span class="n">agg_label</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">agg</span><span class="p">,</span> <span class="n">agg_label</span> <span class="ow">in</span> <span class="n">BASIC_AGGREGATIONS</span>
        <span class="p">]</span>
        <span class="n">function</span> <span class="o">+=</span> <span class="p">[</span><span class="n">_cv_intersection_frequency_factory</span><span class="p">()]</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
            <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;intersections frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;cross_freq&quot;</span><span class="p">),</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
            <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The </span><span class="si">{aggregation}</span><span class="s2"> intersection frequency of the user&quot;</span>
            <span class="s2">&quot; while drawing </span><span class="si">{shape}</span><span class="s2"> shape with their </span><span class="si">{hand}</span><span class="s2"> hand &quot;</span>
            <span class="s2">&quot;for the </span><span class="si">{attempt}</span><span class="s2"> attempt.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data_set</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ExtractSparc">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractSparc">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractSparc</span><span class="p">(</span><span class="n">ExtractShapeMixIn</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract spectral arc length of the up sampled user draw.</span>

<span class="sd">    The spectral arc length is a smoothness measure method. For more</span>
<span class="sd">    information about the ``sparc`` function, see</span>
<span class="sd">    :func:`~dispel.signal.core.sparc`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ExtractSparc.sparc_call">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractSparc.sparc_call">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sparc_call</span><span class="p">(</span><span class="n">touch</span><span class="p">:</span> <span class="n">DrawTouch</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract sparc.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">touch</span><span class="o">.</span><span class="n">valid_up_sampled_path</span>
        <span class="n">sal</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">sparc</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">sal</span></div>


    <span class="n">properties</span> <span class="o">=</span> <span class="s2">&quot;aggregate_valid_touches&quot;</span>
    <span class="n">extract</span> <span class="o">=</span> <span class="n">sparc_call</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;smoothness score&quot;</span><span class="p">,</span> <span class="s2">&quot;smooth&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">RangeValidator</span><span class="p">(</span><span class="n">upper_bound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A digital score of tremor using spectral arc length &quot;</span>
        <span class="s2">&quot;(SPARC) measurement algorithm for </span><span class="si">{shape}</span><span class="s2"> shape drawn &quot;</span>
        <span class="s2">&quot;with their </span><span class="si">{hand}</span><span class="s2"> hand for the </span><span class="si">{attempt}</span><span class="s2"> attempt.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<span class="k">def</span> <span class="nf">_extract_speed_acc</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">matches</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">agg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract speed accuracy.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_speed_accuracy</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">_dtw_agg_dist</span><span class="p">(</span><span class="n">agg</span><span class="p">,</span> <span class="n">matches</span><span class="p">)))</span>  <span class="c1"># type: ignore</span>


<div class="viewcode-block" id="ExtractSpeedAccuracy">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractSpeedAccuracy">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractSpeedAccuracy</span><span class="p">(</span><span class="n">ExtractShapeMixIn</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract speed accuracy.&quot;&quot;&quot;</span>

    <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;valid_data&quot;</span><span class="p">,</span> <span class="s2">&quot;up_sampled_valid_no_overshoot_matches&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="ExtractSpeedAccuracy.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractSpeedAccuracy.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggregation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extract</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">_extract_speed_acc</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">aggregation</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
            <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;accuracy-normalized duration&quot;</span><span class="p">,</span> <span class="s2">&quot;dur_acc&quot;</span><span class="p">),</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;point-1.ms-1&quot;</span><span class="p">,</span>
            <span class="n">aggregation</span><span class="o">=</span><span class="n">aggregation</span><span class="p">,</span>
            <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The accuracy of the subject while drawing </span><span class="si">{shape}</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;with their </span><span class="si">{hand}</span><span class="s2"> hand for the </span><span class="si">{attempt}</span><span class="s2"> attempt &quot;</span>
            <span class="s2">&quot;normalized by the time spend between the first and &quot;</span>
            <span class="s2">&quot;last interaction of the subject with the screen. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Accuracy is one over the </span><span class="si">{</span><span class="n">aggregation</span><span class="si">}</span><span class="s2"> similarity &quot;</span>
            <span class="s2">&quot;between reference shape and drawn shape measured &quot;</span>
            <span class="s2">&quot;using dynamic time warping. See &quot;</span>
            <span class="s2">&quot;:func:`~dispel.signal.dtw.get_dtw_distance`.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<span class="k">def</span> <span class="nf">_extract_dur_acc_normed_combined</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract duration accuracy normed and combined.&quot;&quot;&quot;</span>
    <span class="n">shape_abbr</span> <span class="o">=</span> <span class="n">SHAPE_TO_ABBR</span><span class="p">[</span><span class="n">shape</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">duration_params</span> <span class="o">=</span> <span class="n">get_user_duration</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">normed_score_duration</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">duration_params</span> <span class="o">/</span> <span class="n">DRAWING_USER_DURATION_Q95_MINUS_Q05</span><span class="p">[</span><span class="n">shape_abbr</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">similarity_median</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">_dtw_agg_dist</span><span class="p">(</span><span class="s2">&quot;median&quot;</span><span class="p">,</span> <span class="n">matches</span><span class="p">))</span>
    <span class="n">normed_sim_median</span> <span class="o">=</span> <span class="n">similarity_median</span> <span class="o">/</span> <span class="n">DRAWING_SIM_MEDIAN_Q95_MINUS_Q05</span><span class="p">[</span><span class="n">shape_abbr</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">normed_score_duration</span> <span class="o">+</span> <span class="n">normed_sim_median</span>


<div class="viewcode-block" id="ExtractDurationAccuracyNormedCombined">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractDurationAccuracyNormedCombined">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractDurationAccuracyNormedCombined</span><span class="p">(</span><span class="n">ExtractShapeMixIn</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract duration accuracy normalized and combined score.&quot;&quot;&quot;</span>

    <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;valid_data&quot;</span><span class="p">,</span> <span class="s2">&quot;up_sampled_valid_no_overshoot_matches&quot;</span><span class="p">]</span>

    <span class="nd">@transformation</span>
    <span class="k">def</span> <span class="nf">_extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">_extract_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_extract_dur_acc_normed_combined</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_properties</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_extract_func</span><span class="p">(</span><span class="o">*</span><span class="n">properties</span><span class="p">)])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_dtype</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="ExtractDurationAccuracyNormedCombined.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractDurationAccuracyNormedCombined.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
            <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span>
                <span class="s2">&quot;accuracy and duration normalized then combined&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dur_acc_normed_combined&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
            <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;This measure is a combination of several measurements&quot;</span>
            <span class="s2">&quot;of the subject while drawing </span><span class="si">{shape}</span><span class="s2"> with their &quot;</span>
            <span class="s2">&quot;</span><span class="si">{hand}</span><span class="s2"> hand for the </span><span class="si">{attempt}</span><span class="s2"> attempt. It is &quot;</span>
            <span class="s2">&quot;computed by combining the duration and accuracy. The &quot;</span>
            <span class="s2">&quot;duration is the time spend between the first and &quot;</span>
            <span class="s2">&quot;last interaction of the subject with the screen. &quot;</span>
            <span class="s2">&quot;Accuracy is the median similarity between reference &quot;</span>
            <span class="s2">&quot;shape and drawn shape measured using dynamic time &quot;</span>
            <span class="s2">&quot;warping. &quot;</span>
            <span class="s2">&quot;See :func:`~dispel.signal.dtw.get_dtw_distance`. The &quot;</span>
            <span class="s2">&quot;combination is done following the formula: &quot;</span>
            <span class="s2">&quot;score = (normed_duration + normed_accuracy). The &quot;</span>
            <span class="s2">&quot;normalised version of duration and accuracy are &quot;</span>
            <span class="s2">&quot;computed by dividing the original property by the &quot;</span>
            <span class="s2">&quot;inter-quartile (Q95-Q05) of the resp. property &quot;</span>
            <span class="s2">&quot;computed on healthy population.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ExtractDrawingCompletionRatio">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractDrawingCompletionRatio">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractDrawingCompletionRatio</span><span class="p">(</span><span class="n">ExtractShapeMixIn</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract the completion ratio.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ExtractDrawingCompletionRatio.identity">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractDrawingCompletionRatio.identity">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identity function.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">x</span></div>


    <span class="n">properties</span> <span class="o">=</span> <span class="s2">&quot;distance_ratio&quot;</span>
    <span class="n">extract</span> <span class="o">=</span> <span class="n">identity</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;completion ratio&quot;</span><span class="p">,</span> <span class="s2">&quot;c_ratio&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Percentage of completion of the shape </span><span class="si">{shape}</span><span class="s2"> shape with&quot;</span>
        <span class="s2">&quot; their </span><span class="si">{hand}</span><span class="s2"> hand for the </span><span class="si">{attempt}</span><span class="s2"> attempt.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="ExtractPressure">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractPressure">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractPressure</span><span class="p">(</span><span class="n">ExtractMultipleStep</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract pressure-related measures.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ExtractPressure.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractPressure.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">function</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;func&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
            <span class="s2">&quot;aggregation&quot;</span><span class="p">:</span> <span class="n">AV</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">),</span>
            <span class="s2">&quot;validator&quot;</span><span class="p">:</span> <span class="n">PRESSURE_VALIDATOR</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The </span><span class="si">{aggregation}</span><span class="s2"> pressure applied on the screen&quot;</span>
            <span class="s2">&quot;while drawing </span><span class="si">{shape}</span><span class="s2"> shape with the </span><span class="si">{hand}</span><span class="s2"> hand for &quot;</span>
            <span class="s2">&quot;the </span><span class="si">{attempt}</span><span class="s2"> attempt.&quot;</span>
        <span class="p">)</span>

        <span class="n">functions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">function</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;func&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">variation</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]),</span>
                <span class="s2">&quot;aggregation&quot;</span><span class="p">:</span> <span class="n">AV</span><span class="p">(</span><span class="s2">&quot;coefficient of variation&quot;</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">]</span>

        <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
            <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;pressure&quot;</span><span class="p">,</span> <span class="s2">&quot;press&quot;</span><span class="p">),</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;screen&quot;</span><span class="p">,</span> <span class="n">functions</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ExtractReactionTime">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractReactionTime">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractReactionTime</span><span class="p">(</span><span class="n">ExtractStep</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract reaction time measures.&quot;&quot;&quot;</span>

    <span class="n">data_set_ids</span> <span class="o">=</span> <span class="s2">&quot;screen&quot;</span>
    <span class="n">transform_function</span> <span class="o">=</span> <span class="n">reaction_time</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;reaction time&quot;</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Time taken to initiate a goal directed movement &quot;</span>
        <span class="s2">&quot;after the </span><span class="si">{shape}</span><span class="s2"> shape is displayed for the </span><span class="si">{hand}</span><span class="s2"> hand &quot;</span>
        <span class="s2">&quot;at the </span><span class="si">{attempt}</span><span class="s2"> attempt.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="ExtractReactionTimeAll">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractReactionTimeAll">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractReactionTimeAll</span><span class="p">(</span><span class="n">AggregateRawDataSetColumn</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract reaction time related measures for all levels.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ExtractReactionTimeAll.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractReactionTimeAll.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
            <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;reaction time&quot;</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">),</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span>
            <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The </span><span class="si">{aggregation}</span><span class="s2"> time taken to initiate a goal &quot;</span>
            <span class="s2">&quot;directed movement after a shape is displayed.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">data_set_id</span><span class="o">=</span><span class="s2">&quot;reaction-time&quot;</span><span class="p">,</span>
            <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;reaction_time&quot;</span><span class="p">,</span>
            <span class="n">aggregations</span><span class="o">=</span><span class="n">DEFAULT_AGGREGATIONS</span><span class="p">,</span>
            <span class="n">definition</span><span class="o">=</span><span class="n">definition</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ExtractPressureAll">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractPressureAll">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractPressureAll</span><span class="p">(</span><span class="n">AggregateRawDataSetColumn</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract pressure related measures for all levels.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ExtractPressureAll.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractPressureAll.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
            <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;pressure&quot;</span><span class="p">,</span> <span class="s2">&quot;press&quot;</span><span class="p">),</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
            <span class="n">validator</span><span class="o">=</span><span class="n">PRESSURE_VALIDATOR</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The </span><span class="si">{aggregation}</span><span class="s2"> pressure applied on the screen.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">data_set_id</span><span class="o">=</span><span class="s2">&quot;screen&quot;</span><span class="p">,</span>
            <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pressure&quot;</span><span class="p">,</span>
            <span class="n">aggregations</span><span class="o">=</span><span class="n">DEFAULT_AGGREGATIONS</span><span class="p">,</span>
            <span class="n">definition</span><span class="o">=</span><span class="n">definition</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ExtractPressureAllCV">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractPressureAllCV">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractPressureAllCV</span><span class="p">(</span><span class="n">AggregateRawDataSetColumn</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract pressure related measures for all levels.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ExtractPressureAllCV.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractPressureAllCV.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
            <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;pressure&quot;</span><span class="p">,</span> <span class="s2">&quot;press&quot;</span><span class="p">),</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The </span><span class="si">{aggregation}</span><span class="s2"> pressure applied on the screen.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">data_set_id</span><span class="o">=</span><span class="s2">&quot;screen&quot;</span><span class="p">,</span>
            <span class="n">column_id</span><span class="o">=</span><span class="s2">&quot;pressure&quot;</span><span class="p">,</span>
            <span class="n">aggregations</span><span class="o">=</span><span class="p">[(</span><span class="n">variation</span><span class="p">,</span> <span class="s2">&quot;coefficient of variation&quot;</span><span class="p">)],</span>
            <span class="n">definition</span><span class="o">=</span><span class="n">definition</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<span class="k">def</span> <span class="nf">_dtw_agg_dist</span><span class="p">(</span><span class="n">agg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract aggregated minimum distance.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">matches</span><span class="p">[</span><span class="s2">&quot;min_distance&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;median&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">matches</span><span class="p">[</span><span class="s2">&quot;min_distance&quot;</span><span class="p">])</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Aggregation -</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2"> is not defined for similarity&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="ExtractDTW">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractDTW">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractDTW</span><span class="p">(</span><span class="n">ExtractShapeMixIn</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class to aggregate similarity using dynamic time warping.&quot;&quot;&quot;</span>

    <span class="n">properties</span> <span class="o">=</span> <span class="s2">&quot;up_sampled_valid_no_overshoot_matches&quot;</span>

<div class="viewcode-block" id="ExtractDTW.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractDTW.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggregation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extract</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_dtw_agg_dist</span><span class="p">(</span><span class="n">aggregation</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
            <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;similarity&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">),</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;point&quot;</span><span class="p">,</span>
            <span class="n">aggregation</span><span class="o">=</span><span class="n">aggregation</span><span class="p">,</span>
            <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">aggregation</span><span class="si">}</span><span class="s2"> coupling distance between the &quot;</span>
            <span class="s2">&quot;ideal </span><span class="si">{shape}</span><span class="s2"> shape target and the trajectory drawn &quot;</span>
            <span class="s2">&quot;with the </span><span class="si">{hand}</span><span class="s2"> hand at the </span><span class="si">{attempt}</span><span class="s2"> attempt. &quot;</span>
            <span class="s2">&quot;Coupling distance is measured using dynamic time &quot;</span>
            <span class="s2">&quot;warping.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="DrawTremorMeasures">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawTremorMeasures">[docs]</a>
<span class="k">class</span> <span class="nc">DrawTremorMeasures</span><span class="p">(</span><span class="n">ProcessingStepGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A group of drawing processing steps for tremor measures.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hand</span>
<span class="sd">        The hand on which the tremor measures are to be computed.</span>
<span class="sd">    sensor</span>
<span class="sd">        The sensor on which the tremor measures are to be computed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DrawTremorMeasures.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawTremorMeasures.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hand</span><span class="p">:</span> <span class="n">HandModality</span><span class="p">,</span> <span class="n">sensor</span><span class="p">:</span> <span class="n">SensorModality</span><span class="p">):</span>
        <span class="n">data_set_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sensor</span><span class="p">)</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">RenameColumns</span><span class="p">(</span><span class="n">data_set_id</span><span class="p">,</span> <span class="o">**</span><span class="n">USER_ACC_MAP</span><span class="p">),</span>
            <span class="n">SetTimestampIndex</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_set_id</span><span class="si">}</span><span class="s2">_renamed&quot;</span><span class="p">,</span> <span class="n">DEFAULT_COLUMNS</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="s2">&quot;last&quot;</span>
            <span class="p">),</span>
            <span class="n">Resample</span><span class="p">(</span>
                <span class="n">data_set_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_set_id</span><span class="si">}</span><span class="s2">_renamed_ts&quot;</span><span class="p">,</span>
                <span class="n">aggregations</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;ffill&quot;</span><span class="p">],</span>
                <span class="n">columns</span><span class="o">=</span><span class="n">DEFAULT_COLUMNS</span><span class="p">,</span>
                <span class="n">freq</span><span class="o">=</span><span class="n">FREQ_20HZ</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">TremorMeasures</span><span class="p">(</span>
                <span class="n">sensor</span><span class="o">=</span><span class="n">sensor</span><span class="p">,</span> <span class="n">data_set_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_set_id</span><span class="si">}</span><span class="s2">_renamed_ts_resampled&quot;</span>
            <span class="p">),</span>
        <span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">steps</span><span class="p">,</span>
            <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
            <span class="n">modalities</span><span class="o">=</span><span class="p">[</span><span class="n">hand</span><span class="o">.</span><span class="n">av</span><span class="p">],</span>
            <span class="n">hand</span><span class="o">=</span><span class="n">hand</span><span class="p">,</span>
            <span class="n">level_filter</span><span class="o">=</span><span class="n">LevelIdFilter</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hand</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">-all&quot;</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">NotEmptyDatasetFilter</span><span class="p">(</span><span class="n">data_set_id</span><span class="p">),</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="DrawIntentionalTremorMeasures">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawIntentionalTremorMeasures">[docs]</a>
<span class="k">class</span> <span class="nc">DrawIntentionalTremorMeasures</span><span class="p">(</span><span class="n">ProcessingStepGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A group of drawing processing steps for tremor measures.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="DrawIntentionalTremorMeasures.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawIntentionalTremorMeasures.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data_set_id</span> <span class="o">=</span> <span class="s2">&quot;deceleration&quot;</span>
        <span class="n">new_column_names</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;x_traj&quot;</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;y_traj&quot;</span><span class="p">,</span>
            <span class="s2">&quot;min_distance&quot;</span><span class="p">:</span> <span class="s2">&quot;diss&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tsTouch&quot;</span><span class="p">:</span> <span class="s2">&quot;ts&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">RenameColumns</span><span class="p">(</span><span class="n">data_set_id</span><span class="p">,</span> <span class="o">**</span><span class="n">new_column_names</span><span class="p">),</span>
            <span class="n">SetTimestampIndex</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_set_id</span><span class="si">}</span><span class="s2">_renamed&quot;</span><span class="p">,</span>
                <span class="p">[</span><span class="s2">&quot;x_traj&quot;</span><span class="p">,</span> <span class="s2">&quot;y_traj&quot;</span><span class="p">,</span> <span class="s2">&quot;diss&quot;</span><span class="p">],</span>
                <span class="n">duplicates</span><span class="o">=</span><span class="s2">&quot;last&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Resample</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_set_id</span><span class="si">}</span><span class="s2">_renamed_ts&quot;</span><span class="p">,</span>
                <span class="n">aggregations</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;ffill&quot;</span><span class="p">],</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x_traj&quot;</span><span class="p">,</span> <span class="s2">&quot;y_traj&quot;</span><span class="p">,</span> <span class="s2">&quot;diss&quot;</span><span class="p">],</span>
                <span class="n">freq</span><span class="o">=</span><span class="n">FREQ_60HZ</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">TremorMeasures</span><span class="p">(</span>
                <span class="n">sensor</span><span class="o">=</span><span class="n">SensorModality</span><span class="o">.</span><span class="n">INTENTIONAL</span><span class="p">,</span>
                <span class="n">data_set_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_set_id</span><span class="si">}</span><span class="s2">_renamed_ts_resampled&quot;</span><span class="p">,</span>
                <span class="n">add_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">add_average_signal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;diss&quot;</span><span class="p">,</span> <span class="s2">&quot;x_traj&quot;</span><span class="p">,</span> <span class="s2">&quot;y_traj&quot;</span><span class="p">],</span>
            <span class="p">),</span>
        <span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">level_filter</span><span class="o">=</span><span class="n">NotEmptyDatasetFilter</span><span class="p">(</span><span class="n">data_set_id</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="DRAWProcessingStepsGroupAll">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DRAWProcessingStepsGroupAll">[docs]</a>
<span class="k">class</span> <span class="nc">DRAWProcessingStepsGroupAll</span><span class="p">(</span><span class="n">ProcessingStepGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Processing group for all aggregated levels.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="DRAWProcessingStepsGroupAll.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DRAWProcessingStepsGroupAll.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">ExtractPressureAll</span><span class="p">(),</span> <span class="n">ExtractPressureAllCV</span><span class="p">(),</span> <span class="n">ExtractReactionTimeAll</span><span class="p">()]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">steps</span><span class="p">,</span> <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span> <span class="n">level_filter</span><span class="o">=</span><span class="n">LevelIdFilter</span><span class="p">(</span><span class="s2">&quot;all_levels&quot;</span><span class="p">)</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ExtractCornerMeanDistance">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractCornerMeanDistance">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractCornerMeanDistance</span><span class="p">(</span><span class="n">ExtractShapeMixIn</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract c accuracy.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ExtractCornerMeanDistance.extract_mean_corner_max_dist">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractCornerMeanDistance.extract_mean_corner_max_dist">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">extract_mean_corner_max_dist</span><span class="p">(</span>
        <span class="n">distances</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract mean maximum corner Frechet distance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>  <span class="c1"># type: ignore</span></div>


    <span class="n">properties</span> <span class="o">=</span> <span class="s2">&quot;corners_max_dist&quot;</span>
    <span class="n">extract</span> <span class="o">=</span> <span class="n">extract_mean_corner_max_dist</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;mean corner max distance&quot;</span><span class="p">,</span> <span class="s2">&quot;corner&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;point&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">RangeValidator</span><span class="p">(</span>
            <span class="n">lower_bound</span><span class="o">=-</span><span class="mi">812</span><span class="p">,</span>
            <span class="n">upper_bound</span><span class="o">=</span><span class="mi">812</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The mean maximum distances from corners of the subject&quot;</span>
        <span class="s2">&quot;while drawing </span><span class="si">{shape}</span><span class="s2"> shape with their </span><span class="si">{hand}</span><span class="s2"> hand for &quot;</span>
        <span class="s2">&quot;the </span><span class="si">{attempt}</span><span class="s2"> attempt.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="AggregateCornerMeanDistance">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateCornerMeanDistance">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateCornerMeanDistance</span><span class="p">(</span><span class="n">AggregateMeasures</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregate mean corner max distance measure over all attempts.&quot;&quot;&quot;</span>

    <span class="n">measure_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">ShapeModality</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">AttemptModality</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">HandModality</span><span class="p">:</span>
                <span class="n">measure_ids</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;draw-</span><span class="si">{</span><span class="n">hand</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">shape</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">attempt</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">-corner&quot;</span><span class="p">]</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;mean corner max distance&quot;</span><span class="p">,</span> <span class="s2">&quot;corner&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;point&quot;</span><span class="p">,</span>
        <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">RangeValidator</span><span class="p">(</span>
            <span class="n">lower_bound</span><span class="o">=-</span><span class="mi">812</span><span class="p">,</span>
            <span class="n">upper_bound</span><span class="o">=</span><span class="mi">812</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The mean maximum distances from corners of the subject&quot;</span>
        <span class="s2">&quot;while drawing over all attempts.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="ExtractAxesMeanDistance">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractAxesMeanDistance">[docs]</a>
<span class="k">class</span> <span class="nc">ExtractAxesMeanDistance</span><span class="p">(</span><span class="n">ExtractShapeMixIn</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract mean overshoot distance.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ExtractAxesMeanDistance.extract_mean_axes_dist">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.ExtractAxesMeanDistance.extract_mean_axes_dist">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">extract_mean_axes_dist</span><span class="p">(</span>
        <span class="n">distances</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract mean overshoot distances.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>  <span class="c1"># type: ignore</span></div>


    <span class="n">properties</span> <span class="o">=</span> <span class="s2">&quot;axis_overshoots&quot;</span>
    <span class="n">extract</span> <span class="o">=</span> <span class="n">extract_mean_axes_dist</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;mean axes overshoots&quot;</span><span class="p">,</span> <span class="s2">&quot;axes_over&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;point&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">RangeValidator</span><span class="p">(</span>
            <span class="n">lower_bound</span><span class="o">=-</span><span class="mi">812</span><span class="p">,</span>
            <span class="n">upper_bound</span><span class="o">=</span><span class="mi">812</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The mean overshoot distance from axes of the subject &quot;</span>
        <span class="s2">&quot;while drawing </span><span class="si">{shape}</span><span class="s2"> shape with their </span><span class="si">{hand}</span><span class="s2"> hand for &quot;</span>
        <span class="s2">&quot;the </span><span class="si">{attempt}</span><span class="s2">. To ensure a unbiased value distribution, &quot;</span>
        <span class="s2">&quot;if the user does not go beyond an axis (no overshoot), &quot;</span>
        <span class="s2">&quot;the value will be negative. A user performing the &quot;</span>
        <span class="s2">&quot;drawing close to perfectly will thus present a average &quot;</span>
        <span class="s2">&quot;score close to zero.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="AggregateAxesMeanDistance">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateAxesMeanDistance">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateAxesMeanDistance</span><span class="p">(</span><span class="n">AggregateMeasures</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregate mean corner max distance measure over all attempts.&quot;&quot;&quot;</span>

    <span class="n">measure_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">ShapeModality</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">AttemptModality</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">HandModality</span><span class="p">:</span>
                <span class="n">measure_ids</span> <span class="o">+=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;draw-</span><span class="si">{</span><span class="n">hand</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">shape</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">attempt</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">-axes_over&quot;</span>
                <span class="p">]</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;mean axes overshoots&quot;</span><span class="p">,</span> <span class="s2">&quot;axes_over&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;point&quot;</span><span class="p">,</span>
        <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">RangeValidator</span><span class="p">(</span><span class="n">lower_bound</span><span class="o">=-</span><span class="mi">812</span><span class="p">,</span> <span class="n">upper_bound</span><span class="o">=</span><span class="mi">812</span><span class="p">),</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The mean overshoot distance from axes of the subject &quot;</span>
        <span class="s2">&quot;while drawing over all attempts. To ensure a unbiased &quot;</span>
        <span class="s2">&quot;value distribution, if the user does not go beyond an &quot;</span>
        <span class="s2">&quot;axis (no overshoot), the value will be negative. A user &quot;</span>
        <span class="s2">&quot;performing the drawing close to perfectly will thus &quot;</span>
        <span class="s2">&quot;present a average score close to zero.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="DrawAggregateModalitiesByHand">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawAggregateModalitiesByHand">[docs]</a>
<span class="k">class</span> <span class="nc">DrawAggregateModalitiesByHand</span><span class="p">(</span><span class="n">AggregateModalities</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base step to aggregate measures by hand for DRAW task.</span>

<span class="sd">    From the definition of the measure, all the measures for the different</span>
<span class="sd">    shapes and attempts are retrieved (see get_modalities).</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DrawAggregateModalitiesByHand.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawAggregateModalitiesByHand.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hand</span><span class="p">:</span> <span class="n">HandModality</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hand</span> <span class="o">=</span> <span class="n">hand</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span></div>


<div class="viewcode-block" id="DrawAggregateModalitiesByHand.get_definition">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawAggregateModalitiesByHand.get_definition">[docs]</a>
    <span class="k">def</span> <span class="nf">get_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValueDefinition</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the definition.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">MeasureValueDefinitionPrototype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">)</span><span class="o">.</span><span class="n">create_definition</span><span class="p">(</span>
            <span class="n">modalities</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hand</span><span class="o">.</span><span class="n">av</span><span class="p">],</span> <span class="n">hand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hand</span><span class="o">.</span><span class="n">av</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="DrawAggregateModalitiesByHand.get_modalities">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawAggregateModalitiesByHand.get_modalities">[docs]</a>
    <span class="k">def</span> <span class="nf">get_modalities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AV</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve all modalities combinations for a given hand.&quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">ShapeModality</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">AttemptModality</span><span class="p">:</span>
                <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">hand</span><span class="o">.</span><span class="n">av</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">av</span><span class="p">,</span> <span class="n">attempt</span><span class="o">.</span><span class="n">av</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">ids</span></div>
</div>



<div class="viewcode-block" id="DrawAggregateModalitiesByHandAndShape">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawAggregateModalitiesByHandAndShape">[docs]</a>
<span class="k">class</span> <span class="nc">DrawAggregateModalitiesByHandAndShape</span><span class="p">(</span><span class="n">AggregateModalities</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base step to aggregate measures by hand and shape for DRAW task.</span>

<span class="sd">    From the definition of the measure, all the measures for the different</span>
<span class="sd">    attempts are retrieved (see get_modalities).</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DrawAggregateModalitiesByHandAndShape.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawAggregateModalitiesByHandAndShape.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hand</span><span class="p">:</span> <span class="n">HandModality</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">ShapeModality</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hand</span> <span class="o">=</span> <span class="n">hand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span></div>


<div class="viewcode-block" id="DrawAggregateModalitiesByHandAndShape.get_definition">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawAggregateModalitiesByHandAndShape.get_definition">[docs]</a>
    <span class="k">def</span> <span class="nf">get_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValueDefinition</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the definition.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">MeasureValueDefinitionPrototype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">)</span><span class="o">.</span><span class="n">create_definition</span><span class="p">(</span>
            <span class="n">modalities</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hand</span><span class="o">.</span><span class="n">av</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">av</span><span class="p">],</span>
            <span class="n">hand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hand</span><span class="o">.</span><span class="n">av</span><span class="p">,</span>
            <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="DrawAggregateModalitiesByHandAndShape.get_modalities">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawAggregateModalitiesByHandAndShape.get_modalities">[docs]</a>
    <span class="k">def</span> <span class="nf">get_modalities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AV</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve all modalities combinations for a given hand and shape.&quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">AttemptModality</span><span class="p">:</span>
            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">hand</span><span class="o">.</span><span class="n">av</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">av</span><span class="p">,</span> <span class="n">attempt</span><span class="o">.</span><span class="n">av</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">ids</span></div>
</div>



<div class="viewcode-block" id="AggregateSimilarityByHand">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateSimilarityByHand">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateSimilarityByHand</span><span class="p">(</span><span class="n">DrawAggregateModalitiesByHand</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average similarity values by hand.&quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;similarity&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;point&quot;</span><span class="p">,</span>
        <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The mean coupling distance between the ideal target &quot;</span>
        <span class="s2">&quot;and the trajectory drawn with the </span><span class="si">{hand}</span><span class="s2"> hand for all &quot;</span>
        <span class="s2">&quot;shapes and attempts. Coupling distance is measured &quot;</span>
        <span class="s2">&quot;using dynamic time warping.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="AggregateSpeedSimilarityByHand">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateSpeedSimilarityByHand">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateSpeedSimilarityByHand</span><span class="p">(</span><span class="n">DrawAggregateModalitiesByHand</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average speed/similarity values by hand.&quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;accuracy-normalized duration&quot;</span><span class="p">,</span> <span class="s2">&quot;dur_acc&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;point-1.ms-1&quot;</span><span class="p">,</span>
        <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The accuracy of the subject while drawing with their &quot;</span>
        <span class="s2">&quot;</span><span class="si">{hand}</span><span class="s2"> hand for all attempts normalized by the time &quot;</span>
        <span class="s2">&quot;spend between the first and last interaction of the &quot;</span>
        <span class="s2">&quot;subject with the screen. Accuracy is one over the &quot;</span>
        <span class="s2">&quot;dissimilarity between reference shape and drawn shape &quot;</span>
        <span class="s2">&quot;measured using dynamic time warping. See &quot;</span>
        <span class="s2">&quot;:func:`~dispel.signal.dtw.get_dtw_distance`.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="AggregateSparcByHand">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateSparcByHand">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateSparcByHand</span><span class="p">(</span><span class="n">DrawAggregateModalitiesByHand</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average sparc values by hand.&quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;smoothness score&quot;</span><span class="p">,</span> <span class="s2">&quot;smooth&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">RangeValidator</span><span class="p">(</span><span class="n">upper_bound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A digital score of tremor using spectral arc length &quot;</span>
        <span class="s2">&quot;(SPARC) measurement algorithm for all shapes and &quot;</span>
        <span class="s2">&quot;attempts drawn with their </span><span class="si">{hand}</span><span class="s2"> hand.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="AggregateDurationByHand">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateDurationByHand">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateDurationByHand</span><span class="p">(</span><span class="n">DrawAggregateModalitiesByHand</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average duration of drawing by hand.&quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;drawing duration&quot;</span><span class="p">,</span> <span class="s2">&quot;user_dur&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
        <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The average time spend between the first and last &quot;</span>
        <span class="s2">&quot;interaction of the subject with the screen while drawing &quot;</span>
        <span class="s2">&quot;with their </span><span class="si">{hand}</span><span class="s2"> hand for all shapes and attempts.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="AggregateIntersectionsByHand">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateIntersectionsByHand">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateIntersectionsByHand</span><span class="p">(</span><span class="n">DrawAggregateModalitiesByHand</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average total number of intersections by hand.&quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;intersections&quot;</span><span class="p">,</span> <span class="s2">&quot;cross&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
        <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The average number of times the user cross the shape &quot;</span>
        <span class="s2">&quot;line with his finger while drawing with their </span><span class="si">{hand}</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;hand for all the shapes and attempts.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="AggregateIntersectionsPerSecondsByHand">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateIntersectionsPerSecondsByHand">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateIntersectionsPerSecondsByHand</span><span class="p">(</span><span class="n">DrawAggregateModalitiesByHand</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average the mean number of intersections per second by hand.&quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;intersections per second&quot;</span><span class="p">,</span> <span class="s2">&quot;cross_per_sec&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
        <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The average number of intersection per second the &quot;</span>
        <span class="s2">&quot;user performs with his finger while drawing all shapes &quot;</span>
        <span class="s2">&quot;with their </span><span class="si">{hand}</span><span class="s2"> hand for all shapes and attempts.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="AggregateSimilarity">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateSimilarity">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateSimilarity</span><span class="p">(</span><span class="n">AggregateMeasures</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average similarity values by hand.&quot;&quot;&quot;</span>

    <span class="n">measure_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">ShapeModality</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">AttemptModality</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">HandModality</span><span class="p">:</span>
                <span class="n">measure_ids</span> <span class="o">+=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;draw-</span><span class="si">{</span><span class="n">hand</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">shape</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">attempt</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">-sim-mean&quot;</span>
                <span class="p">]</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;similarity&quot;</span><span class="p">,</span> <span class="s2">&quot;sim&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;point&quot;</span><span class="p">,</span>
        <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The mean coupling distance between the ideal target &quot;</span>
        <span class="s2">&quot;and the trajectory drawn with both hands for all &quot;</span>
        <span class="s2">&quot;shapes and attempts. Coupling distance is measured &quot;</span>
        <span class="s2">&quot;using dynamic time warping.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="AggregateSpeedSimilarity">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateSpeedSimilarity">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateSpeedSimilarity</span><span class="p">(</span><span class="n">AggregateMeasures</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average speed/similarity globally.&quot;&quot;&quot;</span>

    <span class="n">measure_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">ShapeModality</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">AttemptModality</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">HandModality</span><span class="p">:</span>
                <span class="n">measure_ids</span> <span class="o">+=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;draw-</span><span class="si">{</span><span class="n">hand</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">shape</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">attempt</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">-dur_acc-mean&quot;</span>
                <span class="p">]</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;accuracy-normalized duration&quot;</span><span class="p">,</span> <span class="s2">&quot;dur_acc&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;point-1.ms-1&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
        <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The mean of the accuracy of the subject while drawing &quot;</span>
        <span class="s2">&quot;with both hands for all shapes and attempts normalized &quot;</span>
        <span class="s2">&quot;by the time spend between the first and last interaction &quot;</span>
        <span class="s2">&quot;of the subject with the screen. Accuracy is one over the &quot;</span>
        <span class="s2">&quot;dissimilarity between reference shape and drawn shape &quot;</span>
        <span class="s2">&quot;measured using dynamic time warping. See &quot;</span>
        <span class="s2">&quot;:func:`~dispel.signal.dtw.get_dtw_distance`.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="AggregateSparc">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateSparc">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateSparc</span><span class="p">(</span><span class="n">AggregateMeasures</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average smoothness scores globally.&quot;&quot;&quot;</span>

    <span class="n">measure_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">ShapeModality</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">AttemptModality</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">HandModality</span><span class="p">:</span>
                <span class="n">measure_ids</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;draw-</span><span class="si">{</span><span class="n">hand</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">shape</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">attempt</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">-smooth&quot;</span><span class="p">]</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;smoothness score&quot;</span><span class="p">,</span> <span class="s2">&quot;smooth&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">RangeValidator</span><span class="p">(</span><span class="n">upper_bound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A digital score of tremor using spectral arc length &quot;</span>
        <span class="s2">&quot;(SPARC) measurement algorithm for all shapes and &quot;</span>
        <span class="s2">&quot;attempts drawn with both hands.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="AggregateDuration">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateDuration">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateDuration</span><span class="p">(</span><span class="n">AggregateMeasures</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average duration of drawing on all shapes, attempts and hands.&quot;&quot;&quot;</span>

    <span class="n">measure_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">ShapeModality</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">AttemptModality</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">HandModality</span><span class="p">:</span>
                <span class="n">measure_ids</span> <span class="o">+=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;draw-</span><span class="si">{</span><span class="n">hand</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">shape</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">attempt</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">-user_dur&quot;</span>
                <span class="p">]</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;drawing duration&quot;</span><span class="p">,</span> <span class="s2">&quot;user_dur&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
        <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The mean time spend between the first and last &quot;</span>
        <span class="s2">&quot;interaction of the subject with the screen while drawing &quot;</span>
        <span class="s2">&quot;all shapes and attempts with both hands.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="AggregateIntersectionsPerSeconds">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateIntersectionsPerSeconds">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateIntersectionsPerSeconds</span><span class="p">(</span><span class="n">AggregateMeasures</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average the number of intersections per second globally.&quot;&quot;&quot;</span>

    <span class="n">measure_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">ShapeModality</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">AttemptModality</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">HandModality</span><span class="p">:</span>
                <span class="n">measure_ids</span> <span class="o">+=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;draw-</span><span class="si">{</span><span class="n">hand</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">shape</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">attempt</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">-cross_per_sec&quot;</span>
                <span class="p">]</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;intersections per second&quot;</span><span class="p">,</span> <span class="s2">&quot;cross_per_sec&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
        <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The average number of intersection per second the &quot;</span>
        <span class="s2">&quot;user performs with his finger while drawing with both &quot;</span>
        <span class="s2">&quot;hands for all shapes and attempts.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="AggregateIntersections">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateIntersections">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateIntersections</span><span class="p">(</span><span class="n">AggregateMeasures</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average the number of intersections globally.&quot;&quot;&quot;</span>

    <span class="n">measure_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">ShapeModality</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">AttemptModality</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">HandModality</span><span class="p">:</span>
                <span class="n">measure_ids</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;draw-</span><span class="si">{</span><span class="n">hand</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">shape</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">attempt</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">-cross&quot;</span><span class="p">]</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;intersections&quot;</span><span class="p">,</span> <span class="s2">&quot;cross&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">GREATER_THAN_ZERO</span><span class="p">,</span>
        <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The number of times the user cross the shape line &quot;</span>
        <span class="s2">&quot;with his finger while drawing with both hand for all the &quot;</span>
        <span class="s2">&quot;attempts.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="AggregateDistanceThresholdByHandAndShape">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AggregateDistanceThresholdByHandAndShape">[docs]</a>
<span class="k">class</span> <span class="nc">AggregateDistanceThresholdByHandAndShape</span><span class="p">(</span><span class="n">DrawAggregateModalitiesByHandAndShape</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregate Distance threshold flag values by hand and shape.&quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
        <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
        <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;distance threshold&quot;</span><span class="p">,</span> <span class="s2">&quot;dist_thresh&quot;</span><span class="p">),</span>
        <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;bool&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Whether the user completes at least 80</span><span class="si">% o</span><span class="s2">f the expected &quot;</span>
        <span class="s2">&quot;shape </span><span class="si">{shape}</span><span class="s2"> with their </span><span class="si">{hand}</span><span class="s2"> hand for both attempts.&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="DrawUserDistanceThreshold">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawUserDistanceThreshold">[docs]</a>
<span class="k">class</span> <span class="nc">DrawUserDistanceThreshold</span><span class="p">(</span><span class="n">FlagLevelStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flag if a drawing distance ratio is within expected range.&quot;&quot;&quot;</span>

    <span class="n">task_name</span> <span class="o">=</span> <span class="n">TASK_NAME</span>
    <span class="n">flag_name</span> <span class="o">=</span> <span class="n">AV</span><span class="p">(</span><span class="s2">&quot;distance threshold&quot;</span><span class="p">,</span> <span class="s2">&quot;dist_thresh&quot;</span><span class="p">)</span>
    <span class="n">flag_type</span> <span class="o">=</span> <span class="n">FlagType</span><span class="o">.</span><span class="n">BEHAVIORAL</span>
    <span class="n">flag_severity</span> <span class="o">=</span> <span class="n">FlagSeverity</span><span class="o">.</span><span class="n">DEVIATION</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;The user drawing distance ratio is outside the expected &quot;</span>
        <span class="s2">&quot;range of 0.8 - 1.20 for the level </span><span class="si">{level_id}</span><span class="s2">.&quot;</span>
    <span class="p">)</span>
    <span class="n">level_filter</span> <span class="o">=</span> <span class="n">ValidUserPath</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">CreatableShape</span><span class="p">()</span>

    <span class="nd">@flag</span>
    <span class="k">def</span> <span class="nf">_check_distance_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Level</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_flag_kwargs</span><span class="p">(</span><span class="n">level_id</span><span class="o">=</span><span class="n">level</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">level</span><span class="o">.</span><span class="n">get_raw_data_set</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="o">.</span><span class="n">check_dist_thresh</span><span class="p">(</span><span class="n">RangeValidator</span><span class="p">(</span><span class="n">lower_bound</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">upper_bound</span><span class="o">=</span><span class="mf">1.20</span><span class="p">))</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="FlagCompleteDrawing">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.FlagCompleteDrawing">[docs]</a>
<span class="k">class</span> <span class="nc">FlagCompleteDrawing</span><span class="p">(</span><span class="n">FlagLevelStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flag the drawing is complete.&quot;&quot;&quot;</span>

    <span class="n">task_name</span> <span class="o">=</span> <span class="n">TASK_NAME</span>
    <span class="n">flag_name</span> <span class="o">=</span> <span class="n">AV</span><span class="p">(</span><span class="s2">&quot;complete drawing&quot;</span><span class="p">,</span> <span class="s2">&quot;complete_drawing&quot;</span><span class="p">)</span>
    <span class="n">flag_type</span> <span class="o">=</span> <span class="n">FlagType</span><span class="o">.</span><span class="n">TECHNICAL</span>
    <span class="n">flag_severity</span> <span class="o">=</span> <span class="n">FlagSeverity</span><span class="o">.</span><span class="n">DEVIATION</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;The drawing is not complete, the user has not reached the&quot;</span>
        <span class="s2">&quot;endZone or is not considered completed in the context during &quot;</span>
        <span class="s2">&quot;level </span><span class="si">{level_id}</span><span class="s2">.&quot;</span>
    <span class="p">)</span>

    <span class="nd">@flag</span>
    <span class="k">def</span> <span class="nf">_check_complete_drawing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Level</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_flag_kwargs</span><span class="p">(</span><span class="n">level_id</span><span class="o">=</span><span class="n">level</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">screen</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">get_raw_data_set</span><span class="p">(</span><span class="s2">&quot;screen&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="s2">&quot;inEndZone&quot;</span> <span class="ow">in</span> <span class="n">screen</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">screen</span><span class="o">.</span><span class="n">inEndZone</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">level</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_raw_value</span><span class="p">(</span><span class="s2">&quot;drawing_figure_completed&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="DrawTransformAndExtract">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawTransformAndExtract">[docs]</a>
<span class="k">class</span> <span class="nc">DrawTransformAndExtract</span><span class="p">(</span><span class="n">ProcessingStepGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Processing group for all individual levels (shapes).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hand</span>
<span class="sd">        The hand on which the tremor measures are to be computed.</span>
<span class="sd">    shape</span>
<span class="sd">        The shape on which the tremor measures are to be computed.</span>
<span class="sd">    attempt</span>
<span class="sd">        The attempt on which the tremor measures are to be computed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DrawTransformAndExtract.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawTransformAndExtract.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">hand</span><span class="p">:</span> <span class="n">HandModality</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">ShapeModality</span><span class="p">,</span> <span class="n">attempt</span><span class="p">:</span> <span class="n">AttemptModality</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">TransformReactionTime</span><span class="p">(),</span>
            <span class="n">TransformInstantSpeed</span><span class="p">(),</span>
            <span class="n">ExtractSpeedAccuracy</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">),</span>
            <span class="n">ExtractSpeedAccuracy</span><span class="p">(</span><span class="s2">&quot;median&quot;</span><span class="p">),</span>
            <span class="n">ExtractDurationAccuracyNormedCombined</span><span class="p">(),</span>
            <span class="n">ExtractDTW</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">),</span>
            <span class="n">ExtractDTW</span><span class="p">(</span><span class="s2">&quot;median&quot;</span><span class="p">),</span>
            <span class="n">ExtractPressure</span><span class="p">(),</span>
            <span class="n">ExtractDuration</span><span class="p">(),</span>
            <span class="n">ExtractSparc</span><span class="p">(),</span>
            <span class="n">ExtractReactionTime</span><span class="p">(),</span>
            <span class="n">AggregateInstantSpeed</span><span class="p">(),</span>
            <span class="n">ExtractDrawingCompletionRatio</span><span class="p">(),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="n">ShapeModality</span><span class="o">.</span><span class="n">SPIRAL</span><span class="p">:</span>
            <span class="n">steps</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="n">ExtractIntersections</span><span class="p">(),</span>
                <span class="n">ExtractIntersectionsPerSeconds</span><span class="p">(),</span>
                <span class="n">ExtractIntersectionsFrequency</span><span class="p">(),</span>
            <span class="p">]</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ShapeModality</span><span class="o">.</span><span class="n">SQUARE</span><span class="p">,</span> <span class="n">ShapeModality</span><span class="o">.</span><span class="n">SQUARE_COUNTER_CLOCK</span><span class="p">]:</span>
            <span class="n">steps</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="n">TransformDecelerationProfile</span><span class="p">(),</span>
                <span class="n">DrawIntentionalTremorMeasures</span><span class="p">(),</span>  <span class="c1"># type: ignore</span>
                <span class="n">ExtractCornerMeanDistance</span><span class="p">(),</span>
                <span class="n">ExtractAxesMeanDistance</span><span class="p">(),</span>
            <span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">steps</span><span class="p">,</span>
            <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
            <span class="n">modalities</span><span class="o">=</span><span class="p">[</span><span class="n">hand</span><span class="o">.</span><span class="n">av</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">av</span><span class="p">,</span> <span class="n">attempt</span><span class="o">.</span><span class="n">av</span><span class="p">],</span>
            <span class="n">hand</span><span class="o">=</span><span class="n">hand</span><span class="o">.</span><span class="n">av</span><span class="p">,</span>
            <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="o">.</span><span class="n">av</span><span class="p">,</span>
            <span class="n">attempt</span><span class="o">=</span><span class="n">attempt</span><span class="o">.</span><span class="n">av</span><span class="p">,</span>
            <span class="n">level_filter</span><span class="o">=</span><span class="n">HandModalityFilter</span><span class="p">(</span><span class="n">hand</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">ShapeModalityFilter</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">AttemptModalityFilter</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">ValidUserPath</span><span class="p">()</span>
            <span class="o">&amp;</span> <span class="n">CreatableShape</span><span class="p">()</span>
            <span class="o">&amp;</span> <span class="n">ContinuousLevel</span><span class="p">(),</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="DrawingFlag">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawingFlag">[docs]</a>
<span class="k">class</span> <span class="nc">DrawingFlag</span><span class="p">(</span><span class="n">ProcessingStepGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Processing group for all drawing flag.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="DrawingFlag.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawingFlag.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">TransformUserAcceleration</span><span class="p">(),</span>
            <span class="n">UpperLimbOrientationFlagger</span><span class="p">(),</span>
            <span class="n">OnlyOneHandPerformed</span><span class="p">(</span><span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="compute_pacman_score">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.compute_pacman_score">[docs]</a>
<span class="k">def</span> <span class="nf">compute_pacman_score</span><span class="p">(</span>
    <span class="n">shape_dataset</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the pacman score for a level.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    shape_dataset: pd.DataFrame</span>
<span class="sd">        A data frame containing the DrawShape object</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The pacman score.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the up-sampled path and the reference from the shape dataset</span>
    <span class="n">user_path</span> <span class="o">=</span> <span class="n">shape_dataset</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">aggregate_valid_touches</span><span class="o">.</span><span class="n">valid_up_sampled_path</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">shape_dataset</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reference</span>
    <span class="n">user_x</span> <span class="o">=</span> <span class="n">user_path</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">user_y</span> <span class="o">=</span> <span class="n">user_path</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">ref_x</span> <span class="o">=</span> <span class="n">reference</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">ref_y</span> <span class="o">=</span> <span class="n">reference</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">user_x</span><span class="p">,</span> <span class="n">user_y</span><span class="p">))</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">))</span>
    <span class="c1"># Is the distance between target and ref points within the radius range</span>
    <span class="n">eaten_by_user</span> <span class="o">=</span> <span class="p">(</span><span class="n">cdist</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">RADIUS</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">eaten_by_user</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">eaten_by_user</span><span class="p">)</span></div>



<div class="viewcode-block" id="AddRawPacmanScore">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AddRawPacmanScore">[docs]</a>
<span class="k">class</span> <span class="nc">AddRawPacmanScore</span><span class="p">(</span><span class="n">ExtractStep</span><span class="p">,</span> <span class="n">ValidPathAssertionMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add the raw pacman score.</span>

<span class="sd">    A target&#39;s point is considered as &#39;eaten&#39; if that point is within the</span>
<span class="sd">    radius range of any other user path&#39;s point. The pacman score is the ratio</span>
<span class="sd">    between the number of &#39;eaten&#39; points and the total number of target&#39;s</span>
<span class="sd">    point.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AddRawPacmanScore.__init__">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.AddRawPacmanScore.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level_filter</span><span class="p">:</span> <span class="n">LevelFilter</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data_set_ids</span> <span class="o">=</span> <span class="s2">&quot;shape&quot;</span>
        <span class="n">transform_function</span> <span class="o">=</span> <span class="n">compute_pacman_score</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="n">MeasureValueDefinitionPrototype</span><span class="p">(</span>
            <span class="n">task_name</span><span class="o">=</span><span class="n">TASK_NAME</span><span class="p">,</span>
            <span class="n">measure_name</span><span class="o">=</span><span class="n">AV</span><span class="p">(</span><span class="s2">&quot;raw pacman score&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_pacman_score&quot;</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The raw pacman score is the ratio between the number &quot;</span>
            <span class="s2">&quot;of eaten points and the total number of target points&quot;</span>
            <span class="s2">&quot;. A target point is considered eaten if that point is&quot;</span>
            <span class="s2">&quot;within a radius range of any other point of the user &quot;</span>
            <span class="s2">&quot;path. See Radius definition for more information.&quot;</span><span class="p">,</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">data_set_ids</span><span class="o">=</span><span class="n">data_set_ids</span><span class="p">,</span>
            <span class="n">transform_function</span><span class="o">=</span><span class="n">transform_function</span><span class="p">,</span>
            <span class="n">definition</span><span class="o">=</span><span class="n">definition</span><span class="p">,</span>
            <span class="n">level_filter</span><span class="o">=</span><span class="n">level_filter</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="DrawOppositeDirection">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawOppositeDirection">[docs]</a>
<span class="k">class</span> <span class="nc">DrawOppositeDirection</span><span class="p">(</span><span class="n">FlagLevelStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flag infinity shape drawn clockwise.&quot;&quot;&quot;</span>

    <span class="n">task_name</span> <span class="o">=</span> <span class="n">TASK_NAME</span>
    <span class="n">flag_name</span> <span class="o">=</span> <span class="n">AV</span><span class="p">(</span><span class="s2">&quot;opposite direction&quot;</span><span class="p">,</span> <span class="s2">&quot;opp_direction&quot;</span><span class="p">)</span>
    <span class="n">flag_type</span> <span class="o">=</span> <span class="n">FlagType</span><span class="o">.</span><span class="n">BEHAVIORAL</span>
    <span class="n">flag_severity</span> <span class="o">=</span> <span class="n">FlagSeverity</span><span class="o">.</span><span class="n">DEVIATION</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;The user is drawing in the opposite direction for the level </span><span class="si">{level_id}</span><span class="s2">.&quot;</span>
    <span class="n">level_filter</span> <span class="o">=</span> <span class="n">InfinityShapes</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">CreatableShape</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">ContinuousLevel</span><span class="p">()</span>

    <span class="nd">@flag</span>
    <span class="k">def</span> <span class="nf">_assess_valid_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Level</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_flag_kwargs</span><span class="p">(</span><span class="n">level_id</span><span class="o">=</span><span class="n">level</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="c1"># This flag only applies to infinity shapes</span>
        <span class="k">if</span> <span class="s2">&quot;inf&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">level</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This flag should run for infinity shape only.&quot;</span><span class="p">)</span>
        <span class="c1"># Get the shape</span>
        <span class="n">_shape</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">get_raw_data_set</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Compute the x coordinate of the user_path of the first quarter</span>
        <span class="n">all_data</span> <span class="o">=</span> <span class="n">_shape</span><span class="o">.</span><span class="n">all_data</span>
        <span class="n">x_quarter</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>

        <span class="c1"># center_x</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">_shape</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">_shape</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">center_x</span> <span class="o">=</span> <span class="n">x_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">x_quarter</span> <span class="o">&lt;</span> <span class="n">center_x</span></div>



<div class="viewcode-block" id="DrawOvershootRemoval">
<a class="viewcode-back" href="../../../../../../api/dispel.providers.generic.tasks.draw.steps.html#dispel.providers.generic.tasks.draw.steps.DrawOvershootRemoval">[docs]</a>
<span class="k">class</span> <span class="nc">DrawOvershootRemoval</span><span class="p">(</span><span class="n">FlagLevelStep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flag drawing for which we removed more than 10% of user path.&quot;&quot;&quot;</span>

    <span class="n">level_filter</span> <span class="o">=</span> <span class="n">CreatableShape</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">ValidUserPath</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">ContinuousLevel</span><span class="p">()</span>
    <span class="n">task_name</span> <span class="o">=</span> <span class="n">TASK_NAME</span>
    <span class="n">flag_name</span> <span class="o">=</span> <span class="n">AV</span><span class="p">(</span><span class="s2">&quot;overshoot removal&quot;</span><span class="p">,</span> <span class="s2">&quot;excessive_overshoot_removal&quot;</span><span class="p">)</span>
    <span class="n">flag_type</span> <span class="o">=</span> <span class="n">FlagType</span><span class="o">.</span><span class="n">TECHNICAL</span>
    <span class="n">flag_severity</span> <span class="o">=</span> <span class="n">FlagSeverity</span><span class="o">.</span><span class="n">DEVIATION</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;The algorithm detected an overshoot of more than 10</span><span class="si">% f</span><span class="s2">or&quot;</span>
        <span class="s2">&quot; the level </span><span class="si">{level_id}</span><span class="s2">.&quot;</span>
    <span class="p">)</span>

    <span class="nd">@flag</span>
    <span class="k">def</span> <span class="nf">_assess_overshoot_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Level</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_flag_kwargs</span><span class="p">(</span><span class="n">level_id</span><span class="o">=</span><span class="n">level</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="c1"># Get the shape</span>
        <span class="n">_shape</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">get_raw_data_set</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">_shape</span> <span class="o">=</span> <span class="n">_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">len_up_wo_overshoot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_shape</span><span class="o">.</span><span class="n">up_sampled_data_without_overshoot</span><span class="p">)</span>
        <span class="n">len_up</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_shape</span><span class="o">.</span><span class="n">up_sampled_valid_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">len_up</span> <span class="o">-</span> <span class="n">len_up_wo_overshoot</span><span class="p">)</span> <span class="o">/</span> <span class="n">len_up</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.10</span></div>



<span class="n">STEPS</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ProcessingStep</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">STEPS</span> <span class="o">+=</span> <span class="p">[</span>
    <span class="n">FlagCompleteDrawing</span><span class="p">(),</span>
    <span class="n">CreateShapes</span><span class="p">(),</span>
    <span class="n">CreatableShapeFlag</span><span class="p">(),</span>
    <span class="n">TransformValidUserPath</span><span class="p">(),</span>
    <span class="n">FlagContinuousDrawing</span><span class="p">(),</span>
    <span class="n">DrawOvershootRemoval</span><span class="p">(),</span>
    <span class="n">DrawOppositeDirection</span><span class="p">(),</span>
    <span class="n">DrawUserDistanceThreshold</span><span class="p">(),</span>
    <span class="n">DrawingFlag</span><span class="p">(),</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">_hand</span> <span class="ow">in</span> <span class="n">HandModality</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">_shape</span><span class="p">,</span> <span class="n">_attempt</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">ShapeModality</span><span class="p">,</span> <span class="n">AttemptModality</span><span class="p">):</span>
        <span class="n">STEPS</span> <span class="o">+=</span> <span class="p">[</span><span class="n">DrawTransformAndExtract</span><span class="p">(</span><span class="n">_hand</span><span class="p">,</span> <span class="n">_shape</span><span class="p">,</span> <span class="n">_attempt</span><span class="p">)]</span>

    <span class="n">STEPS</span> <span class="o">+=</span> <span class="p">[</span>
        <span class="n">ConcatenateLevels</span><span class="p">(</span>
            <span class="n">new_level_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_hand</span><span class="o">.</span><span class="n">abbr</span><span class="si">}</span><span class="s2">-all&quot;</span><span class="p">,</span>
            <span class="n">data_set_id</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accelerometer&quot;</span><span class="p">,</span> <span class="s2">&quot;gyroscope&quot;</span><span class="p">],</span>
            <span class="n">level_filter</span><span class="o">=</span><span class="n">HandModalityFilter</span><span class="p">(</span><span class="n">_hand</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">ValidUserPath</span><span class="p">()</span>
            <span class="o">&amp;</span> <span class="n">CreatableShape</span><span class="p">()</span>
            <span class="o">&amp;</span> <span class="n">ContinuousLevel</span><span class="p">(),</span>
        <span class="p">)</span>
    <span class="p">]</span>

    <span class="n">STEPS</span> <span class="o">+=</span> <span class="p">[</span>
        <span class="n">DrawTremorMeasures</span><span class="p">(</span><span class="n">_hand</span><span class="p">,</span> <span class="n">sensor</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sensor</span> <span class="ow">in</span> <span class="p">[</span><span class="n">SensorModality</span><span class="o">.</span><span class="n">ACCELEROMETER</span><span class="p">,</span> <span class="n">SensorModality</span><span class="o">.</span><span class="n">GYROSCOPE</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="n">STEPS</span> <span class="o">+=</span> <span class="p">[</span>
        <span class="n">AggregateSimilarityByHand</span><span class="p">(</span><span class="n">_hand</span><span class="p">),</span>
        <span class="n">AggregateSpeedSimilarityByHand</span><span class="p">(</span><span class="n">_hand</span><span class="p">),</span>
        <span class="n">AggregateSparcByHand</span><span class="p">(</span><span class="n">_hand</span><span class="p">),</span>
        <span class="n">AggregateDurationByHand</span><span class="p">(</span><span class="n">_hand</span><span class="p">),</span>
        <span class="n">AggregateIntersectionsPerSecondsByHand</span><span class="p">(</span><span class="n">_hand</span><span class="p">),</span>
        <span class="n">AggregateIntersectionsByHand</span><span class="p">(</span><span class="n">_hand</span><span class="p">),</span>
    <span class="p">]</span>
<span class="n">STEPS</span> <span class="o">+=</span> <span class="p">[</span>
    <span class="n">AggregateSimilarity</span><span class="p">(),</span>
    <span class="n">AggregateSpeedSimilarity</span><span class="p">(),</span>
    <span class="n">AggregateSparc</span><span class="p">(),</span>
    <span class="n">AggregateDuration</span><span class="p">(),</span>
    <span class="n">AggregateIntersectionsPerSeconds</span><span class="p">(),</span>
    <span class="n">AggregateIntersections</span><span class="p">(),</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">_hand</span> <span class="ow">in</span> <span class="n">HandModality</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">_shape</span> <span class="ow">in</span> <span class="n">ShapeModality</span><span class="p">:</span>
        <span class="n">STEPS</span> <span class="o">+=</span> <span class="p">[</span><span class="n">AggregateDistanceThresholdByHandAndShape</span><span class="p">(</span><span class="n">_hand</span><span class="p">,</span> <span class="n">_shape</span><span class="p">)]</span>
<span class="n">STEPS</span> <span class="o">+=</span> <span class="p">[</span>
    <span class="n">ConcatenateLevels</span><span class="p">(</span>
        <span class="n">new_level_id</span><span class="o">=</span><span class="s2">&quot;all_levels&quot;</span><span class="p">,</span>
        <span class="n">data_set_id</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;screen&quot;</span><span class="p">,</span> <span class="s2">&quot;reaction-time&quot;</span><span class="p">],</span>
        <span class="n">level_filter</span><span class="o">=</span><span class="n">ValidUserPath</span><span class="p">()</span>
        <span class="o">&amp;</span> <span class="n">CreatableShape</span><span class="p">()</span>
        <span class="o">&amp;</span> <span class="n">ContinuousLevel</span><span class="p">()</span>
        <span class="o">&amp;</span> <span class="p">(</span>
            <span class="n">ShapeModalityFilter</span><span class="p">(</span><span class="n">ShapeModality</span><span class="o">.</span><span class="n">SPIRAL</span><span class="p">)</span>
            <span class="o">|</span> <span class="n">ShapeModalityFilter</span><span class="p">(</span><span class="n">ShapeModality</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">)</span>
            <span class="o">|</span> <span class="n">ShapeModalityFilter</span><span class="p">(</span><span class="n">ShapeModality</span><span class="o">.</span><span class="n">SQUARE</span><span class="p">)</span>
            <span class="o">|</span> <span class="n">ShapeModalityFilter</span><span class="p">(</span><span class="n">ShapeModality</span><span class="o">.</span><span class="n">SQUARE_COUNTER_CLOCK</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="n">DRAWProcessingStepsGroupAll</span><span class="p">(),</span>
    <span class="n">AggregateCornerMeanDistance</span><span class="p">(),</span>
    <span class="n">AggregateAxesMeanDistance</span><span class="p">(),</span>
<span class="p">]</span>

<span class="c1"># Extra pacman score measures</span>
<span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">HandModality</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">shape</span><span class="p">,</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">ShapeModality</span><span class="p">,</span> <span class="n">AttemptModality</span><span class="p">):</span>
        <span class="n">modalities</span> <span class="o">=</span> <span class="p">[</span><span class="n">hand</span><span class="o">.</span><span class="n">av</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">av</span><span class="p">,</span> <span class="n">attempt</span><span class="o">.</span><span class="n">av</span><span class="p">]</span>
        <span class="n">STEPS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ProcessingStepGroup</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">AddRawPacmanScore</span><span class="p">(</span>
                        <span class="n">level_filter</span><span class="o">=</span><span class="n">HandModalityFilter</span><span class="p">(</span><span class="n">hand</span><span class="p">)</span>
                        <span class="o">&amp;</span> <span class="n">ShapeModalityFilter</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                        <span class="o">&amp;</span> <span class="n">AttemptModalityFilter</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span>
                        <span class="o">&amp;</span> <span class="n">ValidUserPath</span><span class="p">()</span>
                        <span class="o">&amp;</span> <span class="n">CreatableShape</span><span class="p">()</span>
                        <span class="o">&amp;</span> <span class="n">ContinuousLevel</span><span class="p">()</span>
                    <span class="p">)</span>
                <span class="p">],</span>
                <span class="n">modalities</span><span class="o">=</span><span class="p">[</span><span class="n">hand</span><span class="o">.</span><span class="n">av</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">av</span><span class="p">,</span> <span class="n">attempt</span><span class="o">.</span><span class="n">av</span><span class="p">],</span>
                <span class="n">hand</span><span class="o">=</span><span class="n">hand</span><span class="o">.</span><span class="n">av</span><span class="p">,</span>
                <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="o">.</span><span class="n">av</span><span class="p">,</span>
                <span class="n">attempt</span><span class="o">=</span><span class="n">attempt</span><span class="o">.</span><span class="n">av</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../../../../../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>